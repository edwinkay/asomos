"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7666],{7666:(mI,Fu,ee)=>{ee.r(Fu),ee.d(Fu,{Tab1PageModule:()=>ky});var ie=ee(7863),fi=ee(177),zt=ee(4341),jf=ee(1307),mi=ee(4964),b=ee(467),p=ee(4438),Ye=ee(1182),He=ee(9842),Ke=ee(5407),pi=ee(9253),zf=ee(3236),Kf=ee(1985),gi=ee(8455),Mu=ee(7673),Ms=ee(9172),$f=ee(9974),Qf=ee(4360);function Os(){return(0,$f.N)((r,e)=>{let t,n=!1;r.subscribe((0,Qf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var Kt,qu,Ze=ee(6354),Ls=ee(2816),Wf=ee(3294),Ou=ee(5964),Hf=(ee(2438),ee(3345)),_i=ee(7852),Lu=ee(1362),et=ee(8041),ne=ee(1076),Bu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Uu={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,_,v){v||(v=0);var E=Array(16);if("string"==typeof _)for(var A=0;16>A;++A)E[A]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(A=0;16>A;++A)E[A]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;var V=T.g[3],I=(_=T.g[0])+(V^(v=T.g[1])&((A=T.g[2])^V))+E[0]+3614090360&4294967295;I=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=(v=(A=(V=(_=v+(I<<7&4294967295|I>>>25))+((I=V+(A^_&(v^A))+E[1]+3905402710&4294967295)<<12&4294967295|I>>>20))+((I=A+(v^V&(_^v))+E[2]+606105819&4294967295)<<17&4294967295|I>>>15))+((I=v+(_^A&(V^_))+E[3]+3250441966&4294967295)<<22&4294967295|I>>>10))+((I=_+(V^v&(A^V))+E[4]+4118548399&4294967295)<<7&4294967295|I>>>25))+((I=V+(A^_&(v^A))+E[5]+1200080426&4294967295)<<12&4294967295|I>>>20))+((I=A+(v^V&(_^v))+E[6]+2821735955&4294967295)<<17&4294967295|I>>>15))+((I=v+(_^A&(V^_))+E[7]+4249261313&4294967295)<<22&4294967295|I>>>10))+((I=_+(V^v&(A^V))+E[8]+1770035416&4294967295)<<7&4294967295|I>>>25))+((I=V+(A^_&(v^A))+E[9]+2336552879&4294967295)<<12&4294967295|I>>>20))+((I=A+(v^V&(_^v))+E[10]+4294925233&4294967295)<<17&4294967295|I>>>15))+((I=v+(_^A&(V^_))+E[11]+2304563134&4294967295)<<22&4294967295|I>>>10))+((I=_+(V^v&(A^V))+E[12]+1804603682&4294967295)<<7&4294967295|I>>>25))+((I=V+(A^_&(v^A))+E[13]+4254626195&4294967295)<<12&4294967295|I>>>20))+((I=A+(v^V&(_^v))+E[14]+2792965006&4294967295)<<17&4294967295|I>>>15))+((I=v+(_^A&(V^_))+E[15]+1236535329&4294967295)<<22&4294967295|I>>>10))+((I=_+(A^V&(v^A))+E[1]+4129170786&4294967295)<<5&4294967295|I>>>27))+((I=V+(v^A&(_^v))+E[6]+3225465664&4294967295)<<9&4294967295|I>>>23))+((I=A+(_^v&(V^_))+E[11]+643717713&4294967295)<<14&4294967295|I>>>18))+((I=v+(V^_&(A^V))+E[0]+3921069994&4294967295)<<20&4294967295|I>>>12))+((I=_+(A^V&(v^A))+E[5]+3593408605&4294967295)<<5&4294967295|I>>>27))+((I=V+(v^A&(_^v))+E[10]+38016083&4294967295)<<9&4294967295|I>>>23))+((I=A+(_^v&(V^_))+E[15]+3634488961&4294967295)<<14&4294967295|I>>>18))+((I=v+(V^_&(A^V))+E[4]+3889429448&4294967295)<<20&4294967295|I>>>12))+((I=_+(A^V&(v^A))+E[9]+568446438&4294967295)<<5&4294967295|I>>>27))+((I=V+(v^A&(_^v))+E[14]+3275163606&4294967295)<<9&4294967295|I>>>23))+((I=A+(_^v&(V^_))+E[3]+4107603335&4294967295)<<14&4294967295|I>>>18))+((I=v+(V^_&(A^V))+E[8]+1163531501&4294967295)<<20&4294967295|I>>>12))+((I=_+(A^V&(v^A))+E[13]+2850285829&4294967295)<<5&4294967295|I>>>27))+((I=V+(v^A&(_^v))+E[2]+4243563512&4294967295)<<9&4294967295|I>>>23))+((I=A+(_^v&(V^_))+E[7]+1735328473&4294967295)<<14&4294967295|I>>>18))+((I=v+(V^_&(A^V))+E[12]+2368359562&4294967295)<<20&4294967295|I>>>12))+((I=_+(v^A^V)+E[5]+4294588738&4294967295)<<4&4294967295|I>>>28))+((I=V+(_^v^A)+E[8]+2272392833&4294967295)<<11&4294967295|I>>>21))+((I=A+(V^_^v)+E[11]+1839030562&4294967295)<<16&4294967295|I>>>16))+((I=v+(A^V^_)+E[14]+4259657740&4294967295)<<23&4294967295|I>>>9))+((I=_+(v^A^V)+E[1]+2763975236&4294967295)<<4&4294967295|I>>>28))+((I=V+(_^v^A)+E[4]+1272893353&4294967295)<<11&4294967295|I>>>21))+((I=A+(V^_^v)+E[7]+4139469664&4294967295)<<16&4294967295|I>>>16))+((I=v+(A^V^_)+E[10]+3200236656&4294967295)<<23&4294967295|I>>>9))+((I=_+(v^A^V)+E[13]+681279174&4294967295)<<4&4294967295|I>>>28))+((I=V+(_^v^A)+E[0]+3936430074&4294967295)<<11&4294967295|I>>>21))+((I=A+(V^_^v)+E[3]+3572445317&4294967295)<<16&4294967295|I>>>16))+((I=v+(A^V^_)+E[6]+76029189&4294967295)<<23&4294967295|I>>>9))+((I=_+(v^A^V)+E[9]+3654602809&4294967295)<<4&4294967295|I>>>28))+((I=V+(_^v^A)+E[12]+3873151461&4294967295)<<11&4294967295|I>>>21))+((I=A+(V^_^v)+E[15]+530742520&4294967295)<<16&4294967295|I>>>16))+((I=v+(A^V^_)+E[2]+3299628645&4294967295)<<23&4294967295|I>>>9))+((I=_+(A^(v|~V))+E[0]+4096336452&4294967295)<<6&4294967295|I>>>26))+((I=V+(v^(_|~A))+E[7]+1126891415&4294967295)<<10&4294967295|I>>>22))+((I=A+(_^(V|~v))+E[14]+2878612391&4294967295)<<15&4294967295|I>>>17))+((I=v+(V^(A|~_))+E[5]+4237533241&4294967295)<<21&4294967295|I>>>11))+((I=_+(A^(v|~V))+E[12]+1700485571&4294967295)<<6&4294967295|I>>>26))+((I=V+(v^(_|~A))+E[3]+2399980690&4294967295)<<10&4294967295|I>>>22))+((I=A+(_^(V|~v))+E[10]+4293915773&4294967295)<<15&4294967295|I>>>17))+((I=v+(V^(A|~_))+E[1]+2240044497&4294967295)<<21&4294967295|I>>>11))+((I=_+(A^(v|~V))+E[8]+1873313359&4294967295)<<6&4294967295|I>>>26))+((I=V+(v^(_|~A))+E[15]+4264355552&4294967295)<<10&4294967295|I>>>22))+((I=A+(_^(V|~v))+E[6]+2734768916&4294967295)<<15&4294967295|I>>>17))+((I=v+(V^(A|~_))+E[13]+1309151649&4294967295)<<21&4294967295|I>>>11))+((V=(_=v+((I=_+(A^(v|~V))+E[4]+4149444226&4294967295)<<6&4294967295|I>>>26))+((I=V+(v^(_|~A))+E[11]+3174756917&4294967295)<<10&4294967295|I>>>22))^((A=V+((I=A+(_^(V|~v))+E[2]+718787259&4294967295)<<15&4294967295|I>>>17))|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(A+(I<<21&4294967295|I>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+V&4294967295}function a(T,_){this.h=_;for(var v=[],E=!0,A=T.length-1;0<=A;A--){var V=0|T[A];E&&V==_||(v[A]=V,E=!1)}this.g=v}(function e(T,_){function v(){}v.prototype=_.prototype,T.D=_.prototype,T.prototype=new v,T.prototype.constructor=T,T.C=function(E,A,V){for(var I=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)I[yt-2]=arguments[yt];return _.prototype[A].apply(E,I)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,_){void 0===_&&(_=T.length);for(var v=_-this.blockSize,E=this.B,A=this.h,V=0;V<_;){if(0==A)for(;V<=v;)i(this,T,V),V+=this.blockSize;if("string"==typeof T){for(;V<_;)if(E[A++]=T.charCodeAt(V++),A==this.blockSize){i(this,E),A=0;break}}else for(;V<_;)if(E[A++]=T[V++],A==this.blockSize){i(this,E),A=0;break}}this.h=A,this.o+=_},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var v=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=255&v,v/=256;for(this.u(T),T=Array(16),_=v=0;4>_;++_)for(var E=0;32>E;E+=8)T[v++]=this.g[_]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,_){var v=u;return Object.prototype.hasOwnProperty.call(v,T)?v[T]:v[T]=_(T)}(T,function(_){return new a([0|_],0>_?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return k(h(-T));for(var _=[],v=1,E=0;T>=v;E++)_[E]=T/v|0,v*=4294967296;return new a(_,0)}var g=c(0),y=c(1),R=c(16777216);function C(T){if(0!=T.h)return!1;for(var _=0;_<T.g.length;_++)if(0!=T.g[_])return!1;return!0}function F(T){return-1==T.h}function k(T){for(var _=T.g.length,v=[],E=0;E<_;E++)v[E]=~T.g[E];return new a(v,~T.h).add(y)}function U(T,_){return T.add(k(_))}function z(T,_){for(;(65535&T[_])!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function q(T,_){this.g=T,this.h=_}function K(T,_){if(C(_))throw Error("division by zero");if(C(T))return new q(g,g);if(F(T))return _=K(k(T),_),new q(k(_.g),k(_.h));if(F(_))return _=K(T,k(_)),new q(k(_.g),_.h);if(30<T.g.length){if(F(T)||F(_))throw Error("slowDivide_ only works with positive integers.");for(var v=y,E=_;0>=E.l(T);)v=Y(v),E=Y(E);var A=Q(v,1),V=Q(E,1);for(E=Q(E,2),v=Q(v,2);!C(E);){var I=V.add(E);0>=I.l(T)&&(A=A.add(v),V=I),E=Q(E,1),v=Q(v,1)}return _=U(T,A.j(_)),new q(A,_)}for(A=g;0<=T.l(_);){for(v=Math.max(1,Math.floor(T.m()/_.m())),E=48>=(E=Math.ceil(Math.log(v)/Math.LN2))?1:Math.pow(2,E-48),I=(V=h(v)).j(_);F(I)||0<I.l(T);)I=(V=h(v-=E)).j(_);C(V)&&(V=y),A=A.add(V),T=U(T,I)}return new q(A,T)}function Y(T){for(var _=T.g.length+1,v=[],E=0;E<_;E++)v[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(v,T.h)}function Q(T,_){var v=_>>5;_%=32;for(var E=T.g.length-v,A=[],V=0;V<E;V++)A[V]=0<_?T.i(V+v)>>>_|T.i(V+v+1)<<32-_:T.i(V+v);return new a(A,T.h)}(r=a.prototype).m=function(){if(F(this))return-k(this).m();for(var T=0,_=1,v=0;v<this.g.length;v++){var E=this.i(v);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(F(this))return"-"+k(this).toString(T);for(var _=h(Math.pow(T,6)),v=this,E="";;){var A=K(v,_).g,V=((0<(v=U(v,A.j(_))).g.length?v.g[0]:v.h)>>>0).toString(T);if(C(v=A))return V+E;for(;6>V.length;)V="0"+V;E=V+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return F(T=U(this,T))?-1:C(T)?0:1},r.abs=function(){return F(this)?k(this):this},r.add=function(T){for(var _=Math.max(this.g.length,T.g.length),v=[],E=0,A=0;A<=_;A++){var V=E+(65535&this.i(A))+(65535&T.i(A)),I=(V>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);E=I>>>16,v[A]=(I&=65535)<<16|(V&=65535)}return new a(v,-2147483648&v[v.length-1]?-1:0)},r.j=function(T){if(C(this)||C(T))return g;if(F(this))return F(T)?k(this).j(k(T)):k(k(this).j(T));if(F(T))return k(this.j(k(T)));if(0>this.l(R)&&0>T.l(R))return h(this.m()*T.m());for(var _=this.g.length+T.g.length,v=[],E=0;E<2*_;E++)v[E]=0;for(E=0;E<this.g.length;E++)for(var A=0;A<T.g.length;A++){var V=this.i(E)>>>16,I=65535&this.i(E),yt=T.i(A)>>>16,Wr=65535&T.i(A);v[2*E+2*A]+=I*Wr,z(v,2*E+2*A),v[2*E+2*A+1]+=V*Wr,z(v,2*E+2*A+1),v[2*E+2*A+1]+=I*yt,z(v,2*E+2*A+1),v[2*E+2*A+2]+=V*yt,z(v,2*E+2*A+2)}for(E=0;E<_;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=_;E<2*_;E++)v[E]=0;return new a(v,0)},r.A=function(T){return K(this,T).h},r.and=function(T){for(var _=Math.max(this.g.length,T.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)&T.i(E);return new a(v,this.h&T.h)},r.or=function(T){for(var _=Math.max(this.g.length,T.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)|T.i(E);return new a(v,this.h|T.h)},r.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)^T.i(E);return new a(v,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,qu=Uu.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,_){if(0==T.length)throw Error("number format error: empty string");if(2>(_=_||10)||36<_)throw Error("radix out of range: "+_);if("-"==T.charAt(0))return k(f(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(_,8)),E=g,A=0;A<T.length;A+=8){var V=Math.min(8,T.length-A),I=parseInt(T.substring(A,A+V),_);8>V?(V=h(Math.pow(_,V)),E=E.j(V).add(h(I))):E=(E=E.j(v)).add(h(I))}return E},Kt=Uu.Integer=a}).apply(typeof Bu<"u"?Bu:typeof self<"u"?self:typeof window<"u"?window:{});var Gu,ju,or,zu,Ii,Bs,Ku,$u,Qu,yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ut={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof yi&&yi];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var w=o[m];if(!(w in d))break e;d=d[w]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,w={next:function(){if(!m&&d<o.length){var x=d++;return{value:l(x,o[x]),done:!1}}return m=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,m),o.apply(l,w)}}return function(){return o.apply(l,arguments)}}function y(o,l,d){return(y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function R(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function C(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,w,x){for(var O=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)O[ae-2]=arguments[ae];return l.prototype[w].apply(m,O)}}function F(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function k(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const w=o.length||0,x=m.length||0;o.length=w+x;for(let O=0;O<x;O++)o[w+O]=m[O]}else o.push(m)}}function z(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function K(o){return K[" "](o),o}K[" "]=function(){};var Y=!(-1==q().indexOf("Gecko")||-1!=q().toLowerCase().indexOf("webkit")&&-1==q().indexOf("Edge")||-1!=q().indexOf("Trident")||-1!=q().indexOf("MSIE")||-1!=q().indexOf("Edge"));function Q(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function _(o){const l={};for(const d in o)l[d]=o[d];return l}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let d,m;for(let w=1;w<arguments.length;w++){for(d in m=arguments[w],m)o[d]=m[d];for(let x=0;x<v.length;x++)d=v[x],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function A(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function V(o){u.setTimeout(()=>{throw o},0)}function I(){var o=lu;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var Wr=new class U{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new Ny,o=>o.reset());class Ny{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Hr,Xr=!1,lu=new class yt{constructor(){this.h=this.g=null}add(l,d){const m=Wr.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},qd=()=>{const o=u.Promise.resolve(void 0);Hr=()=>{o.then(Fy)}};var Fy=()=>{for(var o;o=I();){try{o.h.call(o.g)}catch(d){V(d)}var l=Wr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Xr=!1};function Ut(){this.s=this.s,this.C=this.C}function Ne(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Ut.prototype.s=!1,Ut.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ut.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ne.prototype.h=function(){this.defaultPrevented=!0};var My=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Jr(o,l){if(Ne.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Y){e:{try{K(l.nodeName);var w=!0;break e}catch{}w=!1}w||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:Oy[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Jr.aa.h.call(this)}}C(Jr,Ne);var Oy={2:"touch",3:"pen",4:"mouse"};Jr.prototype.h=function(){Jr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Yr="closure_listenable_"+(1e6*Math.random()|0),Ly=0;function By(o,l,d,m,w){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=w,this.key=++Ly,this.da=this.fa=!1}function Is(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function vs(o){this.src=o,this.g={},this.h=0}function hu(o,l){var d=l.type;if(d in o.g){var x,m=o.g[d],w=Array.prototype.indexOf.call(m,l,void 0);(x=0<=w)&&Array.prototype.splice.call(m,w,1),x&&(Is(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function du(o,l,d,m){for(var w=0;w<o.length;++w){var x=o[w];if(!x.da&&x.listener==l&&x.capture==!!d&&x.ha==m)return w}return-1}vs.prototype.add=function(o,l,d,m,w){var x=o.toString();(o=this.g[x])||(o=this.g[x]=[],this.h++);var O=du(o,l,m,w);return-1<O?(l=o[O],d||(l.fa=!1)):((l=new By(l,this.src,x,!!m,w)).fa=d,o.push(l)),l};var fu="closure_lm_"+(1e6*Math.random()|0),mu={};function Gd(o,l,d,m,w){if(m&&m.once)return zd(o,l,d,m,w);if(Array.isArray(l)){for(var x=0;x<l.length;x++)Gd(o,l[x],d,m,w);return null}return d=yu(d),o&&o[Yr]?o.K(l,d,h(m)?!!m.capture:!!m,w):jd(o,l,d,!1,m,w)}function jd(o,l,d,m,w,x){if(!l)throw Error("Invalid event type");var O=h(w)?!!w.capture:!!w,ae=gu(o);if(ae||(o[fu]=ae=new vs(o)),(d=ae.add(l,d,m,O,x)).proxy)return d;if(m=function Uy(){const l=qy;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)My||(w=O),void 0===w&&(w=!1),o.addEventListener(l.toString(),m,w);else if(o.attachEvent)o.attachEvent($d(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function zd(o,l,d,m,w){if(Array.isArray(l)){for(var x=0;x<l.length;x++)zd(o,l[x],d,m,w);return null}return d=yu(d),o&&o[Yr]?o.L(l,d,h(m)?!!m.capture:!!m,w):jd(o,l,d,!0,m,w)}function Kd(o,l,d,m,w){if(Array.isArray(l))for(var x=0;x<l.length;x++)Kd(o,l[x],d,m,w);else m=h(m)?!!m.capture:!!m,d=yu(d),o&&o[Yr]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=du(x=o.g[l],d,m,w))&&(Is(x[d]),Array.prototype.splice.call(x,d,1),0==x.length&&(delete o.g[l],o.h--))):o&&(o=gu(o))&&(l=o.g[l.toString()],o=-1,l&&(o=du(l,d,m,w)),(d=-1<o?l[o]:null)&&pu(d))}function pu(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Yr])hu(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent($d(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=gu(l))?(hu(d,o),0==d.h&&(d.src=null,l[fu]=null)):Is(o)}}}function $d(o){return o in mu?mu[o]:mu[o]="on"+o}function qy(o,l){if(o.da)o=!0;else{l=new Jr(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&pu(o),o=d.call(m,l)}return o}function gu(o){return(o=o[fu])instanceof vs?o:null}var _u="__closure_events_fn_"+(1e9*Math.random()>>>0);function yu(o){return"function"==typeof o?o:(o[_u]||(o[_u]=function(l){return o.handleEvent(l)}),o[_u])}function Fe(){Ut.call(this),this.i=new vs(this),this.M=this,this.F=null}function Ue(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new Ne(l,o);else if(l instanceof Ne)l.target=l.target||o;else{var w=l;E(l=new Ne(m,o),w)}if(w=!0,d)for(var x=d.length-1;0<=x;x--){var O=l.g=d[x];w=Ts(O,m,!0,l)&&w}if(w=Ts(O=l.g=o,m,!0,l)&&w,w=Ts(O,m,!1,l)&&w,d)for(x=0;x<d.length;x++)w=Ts(O=l.g=d[x],m,!1,l)&&w}function Ts(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var w=!0,x=0;x<l.length;++x){var O=l[x];if(O&&!O.da&&O.capture==d){var ae=O.listener,xe=O.ha||O.src;O.fa&&hu(o.i,O),w=!1!==ae.call(xe,m)&&w}}return w&&!m.defaultPrevented}function Qd(o,l,d){if("function"==typeof o)d&&(o=y(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=y(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Wd(o){o.g=Qd(()=>{o.g=null,o.i&&(o.i=!1,Wd(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}C(Fe,Ut),Fe.prototype[Yr]=!0,Fe.prototype.removeEventListener=function(o,l,d,m){Kd(this,o,l,d,m)},Fe.prototype.N=function(){if(Fe.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)Is(d[m]);delete o.g[l],o.h--}}this.F=null},Fe.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},Fe.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class Gy extends Ut{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Wd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zr(o){Ut.call(this),this.h=o,this.g={}}C(Zr,Ut);var Hd=[];function Xd(o){Q(o.g,function(l,d){this.g.hasOwnProperty(d)&&pu(l)},o),o.g={}}Zr.prototype.N=function(){Zr.aa.N.call(this),Xd(this)},Zr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Iu=u.JSON.stringify,jy=u.JSON.parse,zy=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function vu(){}function Yd(){}vu.prototype.h=null;var ei={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Tu(){Ne.call(this,"d")}function Eu(){Ne.call(this,"c")}C(Tu,Ne),C(Eu,Ne);var mn={},Zd=null;function Es(){return Zd=Zd||new Fe}function ef(o){Ne.call(this,mn.La,o)}function ti(o){const l=Es();Ue(l,new ef(l))}function tf(o,l){Ne.call(this,mn.STAT_EVENT,o),this.stat=l}function qe(o){const l=Es();Ue(l,new tf(l,o))}function nf(o,l){Ne.call(this,mn.Ma,o),this.size=l}function ni(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function ri(){this.g=!0}function nr(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function Wy(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var w=m[1];if(Array.isArray(w)&&!(1>w.length)){var x=w[0];if("noop"!=x&&"stop"!=x&&"close"!=x)for(var O=1;O<w.length;O++)w[O]=""}}}return Iu(d)}catch{return l}}(o,d)+(m?" "+m:"")})}mn.La="serverreachability",C(ef,Ne),mn.STAT_EVENT="statevent",C(tf,Ne),mn.Ma="timingevent",C(nf,Ne),ri.prototype.xa=function(){this.g=!1},ri.prototype.info=function(){};var Au,As={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},rf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function ws(){}function qt(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new Zr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new sf}function sf(){this.i=null,this.g="",this.h=!1}C(ws,vu),ws.prototype.g=function(){return new XMLHttpRequest},ws.prototype.i=function(){return{}},Au=new ws;var of={},wu={};function Ru(o,l,d){o.L=1,o.v=Ss(It(l)),o.m=d,o.P=!0,af(o,null)}function af(o,l){o.F=Date.now(),Rs(o),o.A=It(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Tf(d.i,"t",m),o.C=0,d=o.j.J,o.h=new sf,o.g=Bf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new Gy(y(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var w="readystatechange";Array.isArray(w)||(w&&(Hd[0]=w.toString()),w=Hd);for(var x=0;x<w.length;x++){var O=Gd(d,w[x],m||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=o.H?_(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),ti(),function Ky(o,l,d,m,w,x){o.info(function(){if(o.g)if(x)for(var O="",ae=x.split("&"),xe=0;xe<ae.length;xe++){var te=ae[xe].split("=");if(1<te.length){var Me=te[0];te=te[1];var Oe=Me.split("_");O=2<=Oe.length&&"type"==Oe[1]?O+(Me+"=")+te+"&":O+(Me+"=redacted&")}}else O=null;else O=x;return"XMLHTTP REQ ("+m+") [attempt "+w+"]: "+l+"\n"+d+"\n"+O})}(o.i,o.u,o.A,o.l,o.R,o.m)}function uf(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function Hy(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?wu:(d=Number(l.substring(d,m)),isNaN(d)?of:(m+=1)+d>l.length?wu:(l=l.slice(m,m+d),o.C=m+d,l))}function Rs(o){o.S=Date.now()+o.I,cf(o,o.I)}function cf(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=ni(y(o.ba,o),l)}function Pu(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function ii(o){0==o.j.G||o.J||Ff(o.j,o)}function pn(o){Pu(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,Xd(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Vu(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Su(d.h,o)))if(!o.K&&Su(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var w=m;if(0==w[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;ks(d),Cs(d)}Du(d),qe(18)}}else d.za=w[1],0<d.za-d.T&&37500>w[2]&&d.F&&0==d.v&&!d.C&&(d.C=ni(y(d.Za,d),6e3));if(1>=df(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else _n(d,11)}else if((o.K||d.g==o)&&ks(d),!z(l))for(w=d.Da.g.parse(l),l=0;l<w.length;l++){let te=w[l];if(d.T=te[0],te=te[1],2==d.G)if("c"==te[0]){d.K=te[1],d.ia=te[2];const Me=te[3];null!=Me&&(d.la=Me,d.j.info("VER="+d.la));const Oe=te[4];null!=Oe&&(d.Aa=Oe,d.j.info("SVER="+d.Aa));const sr=te[5];null!=sr&&"number"==typeof sr&&0<sr&&(d.L=m=1.5*sr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Je=o.g;if(Je){const Fs=Je.g?Je.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fs){var x=m.h;x.g||-1==Fs.indexOf("spdy")&&-1==Fs.indexOf("quic")&&-1==Fs.indexOf("h2")||(x.j=x.l,x.g=new Set,x.h&&(xu(x,x.h),x.h=null))}if(m.D){const Nu=Je.g?Je.g.getResponseHeader("X-HTTP-Session-Id"):null;Nu&&(m.ya=Nu,de(m.I,m.D,Nu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var O=o;if((m=d).qa=Lf(m,m.J?m.ia:null,m.W),O.K){ff(m.h,O);var ae=O,xe=m.L;xe&&(ae.I=xe),ae.B&&(Pu(ae),Rs(ae)),m.g=O}else kf(m);0<d.i.length&&Ds(d)}else"stop"!=te[0]&&"close"!=te[0]||_n(d,7);else 3==d.G&&("stop"==te[0]||"close"==te[0]?"stop"==te[0]?_n(d,7):Cu(d):"noop"!=te[0]&&d.l&&d.l.ta(te),d.v=0)}ti()}catch{}}qt.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==vt(o)?l.j():this.Y(o)},qt.prototype.Y=function(o){try{if(o==this.g)e:{const Oe=vt(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Oe)&&(3!=Oe||this.g&&(this.h.h||this.g.oa()||Sf(this.g)))){this.J||4!=Oe||7==l||ti(),Pu(this);var d=this.g.Z();this.X=d;t:if(uf(this)){var m=Sf(this.g);o="";var w=m.length,x=4==vt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){pn(this),ii(this);var O="";break t}this.h.i=new u.TextDecoder}for(l=0;l<w;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(x&&l==w-1)});m.length=0,this.h.g+=o,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=200==d,function $y(o,l,d,m,w,x,O){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+w+"]: "+l+"\n"+d+"\n"+x+" "+O})}(this.i,this.u,this.A,this.l,this.R,Oe,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ae,xe=this.g;if((ae=xe.g?xe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(ae)){var te=ae;break t}}te=null}if(!(d=te)){this.o=!1,this.s=3,qe(12),pn(this),ii(this);break e}nr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vu(this,d)}if(this.P){let Je;for(d=!0;!this.J&&this.C<O.length;){if(Je=Hy(this,O),Je==wu){4==Oe&&(this.s=4,qe(14),d=!1),nr(this.i,this.l,null,"[Incomplete Response]");break}if(Je==of){this.s=4,qe(15),nr(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}nr(this.i,this.l,Je,null),Vu(this,Je)}if(uf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Oe||0!=O.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<O.length&&!this.W){this.W=!0;var Me=this.j;Me.g==this&&Me.ba&&!Me.M&&(Me.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),ku(Me),Me.M=!0,qe(11))}}else nr(this.i,this.l,O,"[Invalid Chunked Response]"),pn(this),ii(this)}else nr(this.i,this.l,O,null),Vu(this,O);4==Oe&&pn(this),this.o&&!this.J&&(4==Oe?Ff(this.j,this):(this.o=!1,Rs(this)))}else(function dI(o){const l={};o=(o.g&&2<=vt(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(z(o[m]))continue;var d=A(o[m]);const w=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const x=l[w]||[];l[w]=x,x.push(d)}!function T(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<O.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),pn(this),ii(this)}}}catch{}},qt.prototype.cancel=function(){this.J=!0,pn(this)},qt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function Qy(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(ti(),qe(17)),pn(this),this.s=2,ii(this)):cf(this,this.S-o)};var Xy=class{constructor(o,l){this.g=o,this.map=l}};function lf(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hf(o){return!!o.h||!!o.g&&o.g.size>=o.j}function df(o){return o.h?1:o.g?o.g.size:0}function Su(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function xu(o,l){o.g?o.g.add(l):o.h=l}function ff(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function mf(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return F(o.i)}function pf(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function Yy(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function Jy(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),w=m.length,x=0;x<w;x++)l.call(void 0,m[x],d&&d[x],o)}lf.prototype.cancel=function(){if(this.i=mf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var gf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof gn){this.h=o.h,Ps(this,o.j),this.o=o.o,this.g=o.g,Vs(this,o.s),this.l=o.l;var l=o.i,d=new ai;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),_f(this,d),this.m=o.m}else o&&(l=String(o).match(gf))?(this.h=!1,Ps(this,l[1]||"",!0),this.o=si(l[2]||""),this.g=si(l[3]||"",!0),Vs(this,l[4]),this.l=si(l[5]||"",!0),_f(this,l[6]||"",!0),this.m=si(l[7]||"")):(this.h=!1,this.i=new ai(null,this.h))}function It(o){return new gn(o)}function Ps(o,l,d){o.j=d?si(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Vs(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function _f(o,l,d){l instanceof ai?(o.i=l,function sI(o,l){l&&!o.j&&(Gt(o),o.i=null,o.g.forEach(function(d,m){var w=m.toLowerCase();m!=w&&(If(this,m),Tf(this,w,d))},o)),o.j=l}(o.i,o.h)):(d||(l=oi(l,rI)),o.i=new ai(l,o.h))}function de(o,l,d){o.i.set(l,d)}function Ss(o){return de(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function si(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function oi(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,eI),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function eI(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}gn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(oi(l,yf,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(oi(l,yf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(oi(d,"/"==d.charAt(0)?nI:tI,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",oi(d,iI)),o.join("")};var yf=/[#\/\?@]/g,tI=/[#\?:]/g,nI=/[#\?]/g,rI=/[#\?@]/g,iI=/#/g;function ai(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Gt(o){o.g||(o.g=new Map,o.h=0,o.i&&function Zy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),w=null;if(0<=m){var x=o[d].substring(0,m);w=o[d].substring(m+1)}else x=o[d];l(x,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function If(o,l){Gt(o),l=rr(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function vf(o,l){return Gt(o),l=rr(o,l),o.g.has(l)}function Tf(o,l,d){If(o,l),0<d.length&&(o.i=null,o.g.set(rr(o,l),F(d)),o.h+=d.length)}function rr(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function jt(o,l,d,m,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),m(d)}catch{}}function uI(){this.g=new zy}function cI(o,l,d){const m=d||"";try{pf(o,function(w,x){let O=w;h(w)&&(O=Iu(w)),l.push(m+x+"="+encodeURIComponent(O))})}catch(w){throw l.push(m+"type="+encodeURIComponent("_badmap")),w}}function ui(o){this.l=o.Ub||null,this.j=o.eb||!1}function xs(o,l){Fe.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ef(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function ci(o){o.readyState=4,o.l=null,o.j=null,o.v=null,li(o)}function li(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Af(o){let l="";return Q(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function bu(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Af(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):de(o,l,d))}function _e(o){Fe.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ai.prototype).add=function(o,l){Gt(this),this.i=null,o=rr(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){Gt(this),this.g.forEach(function(d,m){d.forEach(function(w){o.call(l,w,m,this)},this)},this)},r.na=function(){Gt(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const w=o[m];for(let x=0;x<w.length;x++)d.push(l[m])}return d},r.V=function(o){Gt(this);let l=[];if("string"==typeof o)vf(this,o)&&(l=l.concat(this.g.get(rr(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Gt(this),this.i=null,vf(this,o=rr(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const x=encodeURIComponent(String(m)),O=this.V(m);for(m=0;m<O.length;m++){var w=x;""!==O[m]&&(w+="="+encodeURIComponent(String(O[m]))),o.push(w)}}return this.i=o.join("&")},C(ui,vu),ui.prototype.g=function(){return new xs(this.l,this.j)},ui.prototype.i=function(o){return function(){return o}}({}),C(xs,Fe),(r=xs.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,li(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ci(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,li(this)),this.g&&(this.readyState=3,li(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ef(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?ci(this):li(this),3==this.readyState&&Ef(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,ci(this))},r.Qa=function(o){this.g&&(this.response=o,ci(this))},r.ga=function(){this.g&&ci(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(xs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),C(_e,Fe);var lI=/^https?$/i,hI=["POST","PUT"];function wf(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Rf(o),bs(o)}function Rf(o){o.A||(o.A=!0,Ue(o,"complete"),Ue(o,"error"))}function Pf(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=vt(o)||2!=o.Z()))if(o.u&&4==vt(o))Qd(o.Ea,0,o);else if(Ue(o,"readystatechange"),4==vt(o)){o.h=!1;try{const O=o.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===O){var w=String(o.D).match(gf)[1]||null;!w&&u.self&&u.self.location&&(w=u.self.location.protocol.slice(0,-1)),m=!lI.test(w?w.toLowerCase():"")}d=m}if(d)Ue(o,"complete"),Ue(o,"success");else{o.m=6;try{var x=2<vt(o)?o.g.statusText:""}catch{x=""}o.l=x+" ["+o.Z()+"]",Rf(o)}}finally{bs(o)}}}function bs(o,l){if(o.g){Vf(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ue(o,"ready");try{d.onreadystatechange=m}catch{}}}function Vf(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function vt(o){return o.g?o.g.readyState:0}function Sf(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function hi(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function xf(o){this.Aa=0,this.i=[],this.j=new ri,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=hi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=hi("baseRetryDelayMs",5e3,o),this.cb=hi("retryDelaySeedMs",1e4,o),this.Wa=hi("forwardChannelMaxRetries",2,o),this.wa=hi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new lf(o&&o.concurrentRequestLimit),this.Da=new uI,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Cu(o){if(bf(o),3==o.G){var l=o.U++,d=It(o.I);if(de(d,"SID",o.K),de(d,"RID",l),de(d,"TYPE","terminate"),di(o,d),(l=new qt(o,o.j,l)).L=2,l.v=Ss(It(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Bf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Rs(l)}Of(o)}function Cs(o){o.g&&(ku(o),o.g.cancel(),o.g=null)}function bf(o){Cs(o),o.u&&(u.clearTimeout(o.u),o.u=null),ks(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function Ds(o){if(!hf(o.h)&&!o.s){o.s=!0;var l=o.Ga;Hr||qd(),Xr||(Hr(),Xr=!0),lu.add(l,o),o.B=0}}function Cf(o,l){var d;d=l?l.l:o.U++;const m=It(o.I);de(m,"SID",o.K),de(m,"RID",d),de(m,"AID",o.T),di(o,m),o.m&&o.o&&bu(m,o.m,o.o),d=new qt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Df(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),xu(o.h,d),Ru(d,m,l)}function di(o,l){o.H&&Q(o.H,function(d,m){de(l,m,d)}),o.l&&pf({},function(d,m){de(l,m,d)})}function Df(o,l,d){d=Math.min(o.i.length,d);var m=o.l?y(o.l.Na,o.l,o):null;e:{var w=o.i;let x=-1;for(;;){const O=["count="+d];-1==x?0<d?(x=w[0].g,O.push("ofs="+x)):x=0:O.push("ofs="+x);let ae=!0;for(let xe=0;xe<d;xe++){let te=w[xe].g;const Me=w[xe].map;if(te-=x,0>te)x=Math.max(0,w[xe].g-100),ae=!1;else try{cI(Me,O,"req"+te+"_")}catch{m&&m(Me)}}if(ae){m=O.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function kf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Hr||qd(),Xr||(Hr(),Xr=!0),lu.add(l,o),o.v=0}}function Du(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=ni(y(o.Fa,o),Mf(o,o.v)),o.v++,0))}function ku(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function Nf(o){o.g=new qt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=It(o.qa);de(l,"RID","rpc"),de(l,"SID",o.K),de(l,"AID",o.T),de(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&de(l,"TO",o.ja),de(l,"TYPE","xmlhttp"),di(o,l),o.m&&o.o&&bu(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Ss(It(l)),d.m=null,d.P=!0,af(d,o)}function ks(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Ff(o,l){var d=null;if(o.g==l){ks(o),ku(o),o.g=null;var m=2}else{if(!Su(o.h,l))return;d=l.D,ff(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var w=o.B;Ue(m=Es(),new nf(m,d)),Ds(o)}else kf(o);else if(3==(w=l.s)||0==w&&0<l.X||!(1==m&&function fI(o,l){return!(df(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=ni(y(o.Ga,o,l),Mf(o,o.B)),o.B++,0)))}(o,l)||2==m&&Du(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),w){case 1:_n(o,5);break;case 4:_n(o,10);break;case 3:_n(o,6);break;default:_n(o,2)}}function Mf(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function _n(o,l){if(o.j.info("Error code "+l),2==l){var d=y(o.fb,o),m=o.Xa;const w=!m;m=new gn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Ps(m,"https"),Ss(m),w?function oI(o,l){const d=new ri;if(u.Image){const m=new Image;m.onload=R(jt,d,"TestLoadImage: loaded",!0,l,m),m.onerror=R(jt,d,"TestLoadImage: error",!1,l,m),m.onabort=R(jt,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(jt,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function aI(o,l){new ri;const m=new AbortController,w=setTimeout(()=>{m.abort(),jt(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(x=>{clearTimeout(w),jt(0,0,!!x.ok,l)}).catch(()=>{clearTimeout(w),jt(0,0,!1,l)})}(m.toString(),d)}else qe(2);o.G=0,o.l&&o.l.sa(l),Of(o),bf(o)}function Of(o){if(o.G=0,o.ka=[],o.l){const l=mf(o.h);(0!=l.length||0!=o.i.length)&&(k(o.ka,l),k(o.ka,o.i),o.h.i.length=0,F(o.i),o.i.length=0),o.l.ra()}}function Lf(o,l,d){var m=d instanceof gn?It(d):new gn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),Vs(m,m.s);else{var w=u.location;m=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;var x=new gn(null);m&&Ps(x,m),l&&(x.g=l),w&&Vs(x,w),d&&(x.l=d),m=x}return l=o.ya,(d=o.D)&&l&&de(m,d,l),de(m,"VER",o.la),di(o,m),m}function Bf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new _e(o.Ca&&!o.pa?new ui({eb:d}):o.pa)).Ha(o.J),l}function Uf(){}function Ns(){}function We(o,l){Fe.call(this),this.g=new xf(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!z(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new ir(this)}function qf(o){Tu.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Gf(){Eu.call(this),this.status=1}function ir(o){this.g=o}(r=_e.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Au.g(),this.v=function Jd(o){return o.h||(o.h=o.i())}(this.o?this.o:Au),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(x){return void wf(this,x)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var w in m)d.set(w,m[w]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const x of m.keys())d.set(x,m.get(x))}m=Array.from(d.keys()).find(x=>"content-type"==x.toLowerCase()),w=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(hI,l,void 0))||m||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,O]of d)this.g.setRequestHeader(x,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Vf(this),this.u=!0,this.g.send(o),this.u=!1}catch(x){wf(this,x)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ue(this,"complete"),Ue(this,"abort"),bs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bs(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Pf(this):this.bb())},r.bb=function(){Pf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<vt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),jy(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=xf.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){qe(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Lf(this,null,this.W),Ds(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const w=new qt(this,this.j,o);let x=this.o;if(this.S&&(x?(x=_(x),E(x,this.S)):x=this.S),null!==this.m||this.O||(w.H=x,x=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Df(this,w,l),de(d=It(this.I),"RID",o),de(d,"CVER",22),this.D&&de(d,"X-HTTP-Session-Id",this.D),di(this,d),x&&(this.O?l="headers="+encodeURIComponent(String(Af(x)))+"&"+l:this.m&&bu(d,this.m,x)),xu(this.h,w),this.Ua&&de(d,"TYPE","init"),this.P?(de(d,"$req",l),de(d,"SID","null"),w.T=!0,Ru(w,d,null)):Ru(w,d,l),this.G=2}}else 3==this.G&&(o?Cf(this,o):0==this.i.length||hf(this.h)||Cf(this))},r.Fa=function(){if(this.u=null,Nf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=ni(y(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Cs(this),Nf(this))},r.Za=function(){null!=this.C&&(this.C=null,Cs(this),Du(this),qe(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Uf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Ns.prototype.g=function(o,l){return new We(o,l)},C(We,Fe),We.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){Cu(this.g)},We.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=Iu(o),o=d);l.i.push(new Xy(l.Ya++,o)),3==l.G&&Ds(l)},We.prototype.N=function(){this.g.l=null,delete this.j,Cu(this.g),delete this.g,We.aa.N.call(this)},C(qf,Tu),C(Gf,Eu),C(ir,Uf),ir.prototype.ua=function(){Ue(this.g,"a")},ir.prototype.ta=function(o){Ue(this.g,new qf(o))},ir.prototype.sa=function(o){Ue(this.g,new Gf)},ir.prototype.ra=function(){Ue(this.g,"b")},Ns.prototype.createWebChannel=Ns.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,Qu=ut.createWebChannelTransport=function(){return new Ns},$u=ut.getStatEventTarget=function(){return Es()},Ku=ut.Event=mn,Bs=ut.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},As.NO_ERROR=0,As.TIMEOUT=8,As.HTTP_ERROR=6,Ii=ut.ErrorCode=As,rf.COMPLETE="complete",zu=ut.EventType=rf,Yd.EventType=ei,ei.OPEN="a",ei.CLOSE="b",ei.ERROR="c",ei.MESSAGE="d",Fe.prototype.listen=Fe.prototype.K,or=ut.WebChannel=Yd,ju=ut.FetchXmlHttpFactory=ui,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Gu=ut.XhrIo=_e}).apply(typeof yi<"u"?yi:typeof self<"u"?self:typeof window<"u"?window:{});const Wu="@firebase/firestore";class Ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let yn="10.12.1";const Tt=new et.Vy("@firebase/firestore");function In(){return Tt.logLevel}function N(r,...e){if(Tt.logLevel<=et.$b.DEBUG){const t=e.map(Us);Tt.debug(`Firestore (${yn}): ${r}`,...t)}}function ye(r,...e){if(Tt.logLevel<=et.$b.ERROR){const t=e.map(Us);Tt.error(`Firestore (${yn}): ${r}`,...t)}}function Ge(r,...e){if(Tt.logLevel<=et.$b.WARN){const t=e.map(Us);Tt.warn(`Firestore (${yn}): ${r}`,...t)}}function Us(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function B(r="Unexpected state"){const e=`FIRESTORE (${yn}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function G(r,e){r||B()}function M(r,e){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends ne.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Te{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Hu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Yf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}}class Zf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class em{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Te;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Te,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,b.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Te)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(G("string"==typeof n.accessToken),new Hu(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return G(null===e||"string"==typeof e),new Ae(e)}}class tm{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class nm{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new tm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Xu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rm{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G("string"==typeof t.token),this.R=t.token,new Xu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function im(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Ju{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=im(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function $(r,e){return r<e?-1:r>e?1:0}function vn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Yu(r){return r+"\0"}class fe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return fe.fromMillis(Date.now())}static fromDate(e){return fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new fe(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class j{constructor(e){this.timestamp=e}static fromTimestamp(e){return new j(e)}static min(){return new j(new fe(0,0))}static max(){return new j(new fe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ar{constructor(e,t,n){void 0===t?t=0:t>e.length&&B(),void 0===n?n=e.length-t:n>e.length-t&&B(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ar.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ar?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class X extends ar{construct(e,t,n){return new X(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new X(t)}static emptyPath(){return new X([])}}const sm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ce extends ar{construct(e,t,n){return new ce(e,t,n)}static isValidIdentifier(e){return sm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ce.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ce(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new D(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new D(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new D(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new D(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ce(t)}static emptyPath(){return new ce([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(X.fromString(e))}static fromName(e){return new L(X.fromString(e).popFirst(5))}static empty(){return new L(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===X.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new X(e.slice()))}}class Tn{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function qs(r){return r.fields.find(e=>2===e.kind)}function $t(r){return r.fields.filter(e=>2!==e.kind)}Tn.UNKNOWN_ID=-1;class Qt{constructor(e,t){this.fieldPath=e,this.kind=t}}class En{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new En(0,$e.min())}}function Zu(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=j.fromTimestamp(1e9===n?new fe(t+1,0):new fe(t,n));return new $e(i,L.empty(),e)}function ec(r){return new $e(r.readTime,r.key,-1)}class $e{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new $e(j.min(),L.empty(),-1)}static max(){return new $e(j.max(),L.empty(),-1)}}function Gs(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=L.comparator(r.documentKey,e.documentKey),0!==t?t:$(r.largestBatchId,e.largestBatchId))}const tc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Et(r){return js.apply(this,arguments)}function js(){return(js=(0,b.A)(function*(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==tc)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,n)=>{t(e)})}static reject(e){return new P((t,n)=>{n(e)})}static waitFor(e){return new P((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next(i=>i?P.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new P((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new P((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class vi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Te,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ur(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=zs(n.target.error);this.V.reject(new ur(e,i))}}static open(e,t,n,i){try{return new vi(t,e.transaction(i,n))}catch(s){throw new ur(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new cm(t)}}class tt{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===tt.S((0,ne.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),Wt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ne.zW)())return!1;if(tt.C())return!0;const e=(0,ne.ZQ)(),t=tt.S(e),n=0<t&&t<10,i=rc(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,b.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new D(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new D(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new ur(e,u))},s.onupgradeneeded=a=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,b.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=vi.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),P.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function rc(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class um{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Wt(this.B.delete())}}class ur extends D{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function At(r){return"IndexedDbTransactionError"===r.name}class cm{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Wt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),Wt(this.store.add(e))}get(e){return Wt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),Wt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),Wt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new P((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new P((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new P((n,i)=>{t.onerror=s=>{const a=zs(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new P((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new um(u),h=t(u.primaryKey,u.value,c);if(h instanceof P){const f=h.catch(g=>(c.done(),P.reject(g)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>P.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Wt(r){return new P((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=zs(n.target.error);t(i)}})}let ic=!1;function zs(r){const e=tt.S((0,ne.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ic||(ic=!0,setTimeout(()=>{throw n},0)),n}}return r}class lm{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){At(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Et(n)}yield t.X(6e4)}))}}class hm{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,b.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return P.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return N("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=ec(s);Gs(a,n)>0&&(n=a)}),new $e(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Qe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function cr(r){return null==r}function lr(r){return 0===r&&1/r==-1/0}function sc(r){return"number"==typeof r&&Number.isInteger(r)&&!lr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function be(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=oc(e)),e=dm(r.get(t),e);return oc(e)}function dm(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function oc(r){return r+"\x01\x01"}function nt(r){const e=r.length;if(G(e>=2),2===e)return G("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),X.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&B(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:B()}s=a+2}return new X(n)}const ac=["userId","batchId"];function Ti(r,e){return[r,be(e)]}function uc(r,e,t){return[r,be(e),t]}const fm={},mm=["prefixPath","collectionGroup","readTime","documentId"],pm=["prefixPath","collectionGroup","documentId"],gm=["collectionGroup","readTime","prefixPath","documentId"],_m=["canonicalId","targetId"],ym=["targetId","path"],Im=["path","targetId"],vm=["collectionId","parent"],Tm=["indexId","uid"],Em=["uid","sequenceNumber"],Am=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wm=["indexId","uid","orderedDocumentKey"],Rm=["userId","collectionPath","documentId"],Pm=["userId","collectionPath","largestBatchId"],Vm=["userId","collectionGroup","largestBatchId"],cc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Sm=[...cc,"documentOverlays"],lc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],hc=lc,dc=[...hc,"indexConfiguration","indexState","indexEntries"],xm=dc;class Ks extends nc{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function we(r,e){const t=M(r);return tt.F(t._e,e)}function fc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function wt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function pc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ue{constructor(e,t){this.comparator=e,this.root=t||Pe.EMPTY}insert(e,t){return new ue(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pe.BLACK,null,null))}remove(e){return new ue(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ei(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ei(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ei(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ei(this.root,e,this.comparator,!0)}}class Ei{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pe{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Pe.RED,this.left=null!=i?i:Pe.EMPTY,this.right=null!=s?s:Pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Pe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Pe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Pe.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();const e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}}Pe.EMPTY=null,Pe.RED=!0,Pe.BLACK=!1,Pe.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Pe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class se{constructor(e){this.comparator=e,this.data=new ue(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new gc(this.data.getIterator())}getIteratorFrom(e){return new gc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof se)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new se(this.comparator);return t.data=e,t}}class gc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function An(r){return r.hasNext()?r.getNext():void 0}class je{constructor(e){this.fields=e,e.sort(ce.comparator)}static empty(){return new je([])}unionWith(e){let t=new se(ce.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new je(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return vn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class _c extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ee{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new _c("Invalid base64 string: "+s):s}}(e);return new Ee(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Ee(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ee.EMPTY_BYTE_STRING=new Ee("");const Cm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ct(r){if(G(!!r),"string"==typeof r){let e=0;const t=Cm.exec(r);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ge(r.seconds),nanos:ge(r.nanos)}}function ge(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function lt(r){return"string"==typeof r?Ee.fromBase64String(r):Ee.fromUint8Array(r)}function Ai(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function wi(r){const e=r.mapValue.fields.__previous_value__;return Ai(e)?wi(e):e}function hr(r){const e=ct(r.mapValue.fields.__local_write_time__.timestampValue);return new fe(e.seconds,e.nanos)}class Dm{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class Rt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Rt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Rt&&e.projectId===this.projectId&&e.database===this.database}}const Pt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ri={nullValue:"NULL_VALUE"};function Vt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ai(r)?4:Tc(r)?9007199254740991:10:B()}function rt(r,e){if(r===e)return!0;const t=Vt(r);if(t!==Vt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return hr(r).isEqual(hr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=ct(i.timestampValue),u=ct(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,lt(r.bytesValue).isEqual(lt(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ge(i.geoPointValue.latitude)===ge(s.geoPointValue.latitude)&&ge(i.geoPointValue.longitude)===ge(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ge(i.integerValue)===ge(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=ge(i.doubleValue),u=ge(s.doubleValue);return a===u?lr(a)===lr(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return vn(r.arrayValue.values||[],e.arrayValue.values||[],rt);case 10:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(fc(a)!==fc(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!rt(a[c],u[c])))return!1;return!0}(r,e);default:return B()}var s}function dr(r,e){return void 0!==(r.values||[]).find(t=>rt(t,e))}function St(r,e){if(r===e)return 0;const t=Vt(r),n=Vt(e);if(t!==n)return $(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=ge(s.integerValue||s.doubleValue),c=ge(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return yc(r.timestampValue,e.timestampValue);case 4:return yc(hr(r),hr(e));case 5:return $(r.stringValue,e.stringValue);case 6:return function(s,a){const u=lt(s),c=lt(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=$(u[h],c[h]);if(0!==f)return f}return $(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=$(ge(s.latitude),ge(a.latitude));return 0!==u?u:$(ge(s.longitude),ge(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,a){const u=s.values||[],c=a.values||[];for(let h=0;h<u.length&&h<c.length;++h){const f=St(u[h],c[h]);if(f)return f}return $(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Pt.mapValue&&a===Pt.mapValue)return 0;if(s===Pt.mapValue)return 1;if(a===Pt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){const y=$(c[g],f[g]);if(0!==y)return y;const R=St(u[c[g]],h[f[g]]);if(0!==R)return R}return $(c.length,f.length)}(r.mapValue,e.mapValue);default:throw B()}}function yc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return $(r,e);const t=ct(r),n=ct(e),i=$(t.seconds,n.seconds);return 0!==i?i:$(t.nanos,n.nanos)}function wn(r){return $s(r)}function $s(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ct(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?lt(r.bytesValue).toBase64():"referenceValue"in r?L.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=$s(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${$s(t.fields[a])}`;return i+"}"}(r.mapValue):B()}function Ht(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Qs(r){return!!r&&"integerValue"in r}function fr(r){return!!r&&"arrayValue"in r}function Ic(r){return!!r&&"nullValue"in r}function vc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Vi(r){return!!r&&"mapValue"in r}function mr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return wt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=mr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Tc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}function km(r){return"nullValue"in r?Ri:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Ht(Rt.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:B()}function Nm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Ht(Rt.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?Pt:B()}function Ec(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Ac(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Ve{constructor(e){this.value=e}static empty(){return new Ve({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Vi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mr(t)}setAll(e){let t=ce.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=mr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Vi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Vi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){wt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Ve(mr(this.value))}}function wc(r){const e=[];return wt(r.fields,(t,n)=>{const i=new ce([t]);if(Vi(n)){const s=wc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new je(e)}class le{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new le(e,0,j.min(),j.min(),j.min(),Ve.empty(),0)}static newFoundDocument(e,t,n,i){return new le(e,1,t,j.min(),n,i,0)}static newNoDocument(e,t){return new le(e,2,t,j.min(),j.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new le(e,3,t,j.min(),j.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof le&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new le(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xt{constructor(e,t){this.position=e,this.inclusive=t}}function Rc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?L.comparator(L.fromName(a.referenceValue),t.key):St(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Pc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!rt(r.position[t],e.position[t]))return!1;return!0}class pr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Fm(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Vc{}class J extends Vc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Mm(e,t,n):"array-contains"===t?new Bm(e,n):"in"===t?new kc(e,n):"not-in"===t?new Um(e,n):"array-contains-any"===t?new qm(e,n):new J(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Om(e,n):new Lm(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(St(t,this.value)):null!==t&&Vt(this.value)===Vt(t)&&this.matchesComparison(St(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class re extends Vc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new re(e,t)}matches(e){return Rn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rn(r){return"and"===r.op}function Ws(r){return"or"===r.op}function Hs(r){return Sc(r)&&Rn(r)}function Sc(r){for(const e of r.filters)if(e instanceof re)return!1;return!0}function Xs(r){if(r instanceof J)return r.field.canonicalString()+r.op.toString()+wn(r.value);if(Hs(r))return r.filters.map(e=>Xs(e)).join(",");{const e=r.filters.map(t=>Xs(t)).join(",");return`${r.op}(${e})`}}function xc(r,e){return r instanceof J?(n=r,(i=e)instanceof J&&n.op===i.op&&n.field.isEqual(i.field)&&rt(n.value,i.value)):r instanceof re?function(n,i){return i instanceof re&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&xc(a,i.filters[u]),!0)}(r,e):void B();var n,i}function bc(r,e){const t=r.filters.concat(e);return re.create(t,r.op)}function Cc(r){return r instanceof J?`${(t=r).field.canonicalString()} ${t.op} ${wn(t.value)}`:r instanceof re?function(t){return t.op.toString()+" {"+t.getFilters().map(Cc).join(" ,")+"}"}(r):"Filter";var t}class Mm extends J{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class Om extends J{constructor(e,t){super(e,"in",t),this.keys=Dc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Lm extends J{constructor(e,t){super(e,"not-in",t),this.keys=Dc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Dc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}class Bm extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fr(t)&&dr(t.arrayValue,this.value)}}class kc extends J{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&dr(this.value.arrayValue,t)}}class Um extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(dr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!dr(this.value.arrayValue,t)}}class qm extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>dr(this.value.arrayValue,n))}}class Gm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Js(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Gm(r,e,t,n,i,s,a)}function Xt(r){const e=M(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Xs(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),cr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>wn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>wn(n)).join(",")),e.ue=t}return e.ue}function gr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Fm(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!xc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Pc(r.startAt,e.startAt)&&Pc(r.endAt,e.endAt)}function Si(r){return L.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function xi(r,e){return r.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function Nc(r,e,t){let n=Ri,i=!0;for(const s of xi(r,e)){let a=Ri,u=!0;switch(s.op){case"<":case"<=":a=km(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ri}Ec({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Ec({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function Fc(r,e,t){let n=Pt,i=!0;for(const s of xi(r,e)){let a=Pt,u=!0;switch(s.op){case">=":case">":a=Nm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Pt}Ac({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Ac({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class ht{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function Mc(r,e,t,n,i,s,a,u){return new ht(r,e,t,n,i,s,a,u)}function Pn(r){return new ht(r)}function Oc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Ys(r){return null!==r.collectionGroup}function Vn(r){const e=M(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new se(ce.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new pr(s,n))}),t.has(ce.keyField().canonicalString())||e.ce.push(new pr(ce.keyField(),n))}return e.ce}function Ce(r){const e=M(r);return e.le||(e.le=function Bc(r,e){if("F"===r.limitType)return Js(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new pr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new xt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new xt(r.startAt.position,r.startAt.inclusive):null;return Js(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Vn(r))),e.le}function Zs(r,e){const t=r.filters.concat([e]);return new ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function bi(r,e,t){return new ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function _r(r,e){return gr(Ce(r),Ce(e))&&r.limitType===e.limitType}function Uc(r){return`${Xt(Ce(r))}|lt:${r.limitType}`}function Sn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Cc(i)).join(", ")}]`),cr(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>wn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>wn(i)).join(",")),`Target(${n})`}(Ce(r))}; limitType=${r.limitType})`}function yr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Vn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=Rc(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,Vn(n),i)||n.endAt&&!function(a,u,c){const h=Rc(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,Vn(n),i)));var n,i}function qc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Gc(r){return(e,t)=>{let n=!1;for(const i of Vn(r)){const s=jm(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function jm(r,e,t){const n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?St(c,h):B()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return B()}}class dt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){wt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return pc(this.inner)}size(){return this.innerSize}}const zm=new ue(L.comparator);function ze(){return zm}const jc=new ue(L.comparator);function Ir(...r){let e=jc;for(const t of r)e=e.insert(t.key,t);return e}function zc(r){let e=jc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function it(){return vr()}function Kc(){return vr()}function vr(){return new dt(r=>r.toString(),(r,e)=>r.isEqual(e))}const Km=new ue(L.comparator),$m=new se(L.comparator);function W(...r){let e=$m;for(const t of r)e=e.add(t);return e}const Qm=new se($);function eo(){return Qm}function $c(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lr(e)?"-0":e}}function Qc(r){return{integerValue:""+r}}function Wc(r,e){return sc(e)?Qc(e):$c(r,e)}class Ci{constructor(){this._=void 0}}function Wm(r,e,t){return r instanceof xn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ai(s)&&(s=wi(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Jt?Xc(r,e):r instanceof Yt?Jc(r,e):function(i,s){const a=Hc(i,s),u=Yc(a)+Yc(i.Pe);return Qs(a)&&Qs(i.Pe)?Qc(u):$c(i.serializer,u)}(r,e)}function Hm(r,e,t){return r instanceof Jt?Xc(r,e):r instanceof Yt?Jc(r,e):t}function Hc(r,e){return r instanceof bn?Qs(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class xn extends Ci{}class Jt extends Ci{constructor(e){super(),this.elements=e}}function Xc(r,e){const t=Zc(e);for(const n of r.elements)t.some(i=>rt(i,n))||t.push(n);return{arrayValue:{values:t}}}class Yt extends Ci{constructor(e){super(),this.elements=e}}function Jc(r,e){let t=Zc(e);for(const n of r.elements)t=t.filter(i=>!rt(i,n));return{arrayValue:{values:t}}}class bn extends Ci{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Yc(r){return ge(r.integerValue||r.doubleValue)}function Zc(r){return fr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Tr{constructor(e,t){this.field=e,this.transform=t}}class Jm{constructor(e,t){this.version=e,this.transformResults=t}}class me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new me}static exists(e){return new me(void 0,e)}static updateTime(e){return new me(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Di(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class ki{}function el(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Dn(r.key,me.none()):new Cn(r.key,r.data,me.none());{const t=r.data,n=Ve.empty();let i=new se(ce.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new ft(r.key,n,new je(i.toArray()),me.none())}}function Ym(r,e,t){r instanceof Cn?function(i,s,a){const u=i.value.clone(),c=rl(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof ft?function(i,s,a){if(!Di(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=rl(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(nl(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Er(r,e,t,n){return r instanceof Cn?function(s,a,u,c){if(!Di(s.precondition,a))return u;const h=s.value.clone(),f=il(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof ft?function(s,a,u,c){if(!Di(s.precondition,a))return u;const h=il(s.fieldTransforms,c,a),f=a.data;return f.setAll(nl(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Di(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Zm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Hc(n.transform,i||null);null!=s&&(null===t&&(t=Ve.empty()),t.set(n.field,s))}return t||null}function tl(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&vn(n,i,(s,a)=>function Xm(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Jt&&i instanceof Jt||n instanceof Yt&&i instanceof Yt?vn(n.elements,i.elements,rt):n instanceof bn&&i instanceof bn?rt(n.Pe,i.Pe):n instanceof xn&&i instanceof xn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Cn extends ki{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ft extends ki{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function nl(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function rl(r,e,t){const n=new Map;G(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,Hm(a,u,t[i]))}return n}function il(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,Wm(s,a,e))}return n}class Dn extends ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class to extends ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class no{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Ym(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Er(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Er(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Kc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=el(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(j.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&vn(this.mutations,e.mutations,(t,n)=>tl(t,n))&&vn(this.baseMutations,e.baseMutations,(t,n)=>tl(t,n))}}class ro{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){G(e.mutations.length===n.length);let i=function(){return Km}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new ro(e,t,n,i)}}class io{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ep{constructor(e,t){this.count=e,this.unchangedNames=t}}var ve,Z;function ol(r){switch(r){default:return B();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function al(r){if(void 0===r)return ye("GRPC error has no .code"),S.UNKNOWN;switch(r){case ve.OK:return S.OK;case ve.CANCELLED:return S.CANCELLED;case ve.UNKNOWN:return S.UNKNOWN;case ve.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case ve.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case ve.INTERNAL:return S.INTERNAL;case ve.UNAVAILABLE:return S.UNAVAILABLE;case ve.UNAUTHENTICATED:return S.UNAUTHENTICATED;case ve.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case ve.NOT_FOUND:return S.NOT_FOUND;case ve.ALREADY_EXISTS:return S.ALREADY_EXISTS;case ve.PERMISSION_DENIED:return S.PERMISSION_DENIED;case ve.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case ve.ABORTED:return S.ABORTED;case ve.OUT_OF_RANGE:return S.OUT_OF_RANGE;case ve.UNIMPLEMENTED:return S.UNIMPLEMENTED;case ve.DATA_LOSS:return S.DATA_LOSS;default:return B()}}(Z=ve||(ve={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";function ul(){return new TextEncoder}const tp=new Kt([4294967295,4294967295],0);function cl(r){const e=ul().encode(r),t=new qu;return t.update(e),new Uint8Array(t.digest())}function ll(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Kt([t,n],0),new Kt([i,s],0)]}class so{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ar(`Invalid padding: ${t}`);if(n<0)throw new Ar(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ar(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ar(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Kt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Kt.fromNumber(n)));return 1===i.compare(tp)&&(i=new Kt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=cl(e),[n,i]=ll(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new so(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=cl(e),[n,i]=ll(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ar extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class wr{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Rr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new wr(j.min(),i,new ue($),ze(),W())}}class Rr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Rr(n,t,W(),W(),W())}}class Fi{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class hl{constructor(e,t){this.targetId=e,this.me=t}}class dl{constructor(e,t,n=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class fl{constructor(){this.fe=0,this.ge=pl(),this.pe=Ee.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=W(),t=W(),n=W();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:B()}}),new Rr(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=pl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class np{constructor(e){this.Le=e,this.Be=new Map,this.ke=ze(),this.qe=ml(),this.Qe=new ue($)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Si(s))if(0===n){const a=new L(s.path);this.Ue(t,a,le.newNoDocument(a,j.min()))}else G(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=lt(n).toUint8Array()}catch(c){if(c instanceof _c)return Ge("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new so(a,i,s)}catch(c){return Ge(c instanceof Ar?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Si(u.target)){const c=new L(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,le.newNoDocument(c,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let n=W();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new wr(e,t,this.Qe,this.ke,n);return this.ke=ze(),this.qe=ml(),this.Qe=new ue($),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new fl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new se($),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new fl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ml(){return new ue(L.comparator)}function pl(){return new ue(L.comparator)}const rp={asc:"ASCENDING",desc:"DESCENDING"},ip={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sp={and:"AND",or:"OR"};class op{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function oo(r,e){return r.useProto3Json||cr(e)?e:{value:e}}function kn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function ap(r,e){return kn(r,e.toTimestamp())}function Ie(r){return G(!!r),j.fromTimestamp(function(t){const n=ct(t);return new fe(n.seconds,n.nanos)}(r))}function ao(r,e){return uo(r,e).canonicalString()}function uo(r,e){const t=(i=r,new X(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function _l(r){const e=X.fromString(r);return G(Sl(e)),e}function Pr(r,e){return ao(r.databaseId,e.path)}function st(r,e){const t=_l(e);if(t.get(1)!==r.databaseId.projectId)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(vl(t))}function yl(r,e){return ao(r.databaseId,e)}function Il(r){const e=_l(r);return 4===e.length?X.emptyPath():vl(e)}function co(r){return new X(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function vl(r){return G(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function Tl(r,e,t){return{name:Pr(r,e),fields:t.value.mapValue.fields}}function El(r,e,t){const n=st(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):j.min(),a=new Ve({mapValue:{fields:e.fields}}),u=le.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Vr(r,e){let t;if(e instanceof Cn)t={update:Tl(r,e.key,e.value)};else if(e instanceof Dn)t={delete:Pr(r,e.key)};else if(e instanceof ft)t={update:Tl(r,e.key,e.data),updateMask:pp(e.fieldMask)};else{if(!(e instanceof to))return B();t={verify:Pr(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof xn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Jt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof bn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw B()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:ap(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:B()),t;var s}function lo(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?me.updateTime(Ie(s.updateTime)):void 0!==s.exists?me.exists(s.exists):me.none():me.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(G("REQUEST_TIME"===u.setToServerValue),c=new xn):"appendMissingElements"in u?c=new Jt(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Yt(u.removeAllFromArray.values||[]):"increment"in u?c=new bn(a,u.increment):B();const h=ce.fromServerFormat(u.fieldPath);return new Tr(h,c)}(r,i)):[];var s;if(e.update){const i=st(r,e.update.name),s=new Ve({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new je((e.updateMask.fieldPaths||[]).map(f=>ce.fromServerFormat(f)));return new ft(i,s,a,t,n)}return new Cn(i,s,t,n)}if(e.delete){const i=st(r,e.delete);return new Dn(i,t)}if(e.verify){const i=st(r,e.verify);return new to(i,t)}return B()}function Al(r,e){return{documents:[yl(r,e.path)]}}function Mi(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=yl(r,i);const s=function(h){if(0!==h.length)return Vl(re.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:bt((y=f).field),direction:dp(y.dir)};var y})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=oo(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Rl(r){let e=Il(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){G(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const y=Pl(g);return y instanceof re&&Hs(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(y=>{return new pr(Nn((C=y).field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction));var C}));let u=null;t.limit&&(u=function(g){let y;return y="object"==typeof g?g.value:g,cr(y)?null:y}(t.limit));let c=null;var g;t.startAt&&(c=new xt((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new xt(g.values||[],!g.before)}(t.endAt)),Mc(e,i,a,s,u,"F",c,h)}function Pl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Nn(t.unaryFilter.field);return J.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Nn(t.unaryFilter.field);return J.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Nn(t.unaryFilter.field);return J.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Nn(t.unaryFilter.field);return J.create(a,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(r):void 0!==r.fieldFilter?J.create(Nn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return re.create(t.compositeFilter.filters.map(n=>Pl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(r):B();var t}function dp(r){return rp[r]}function fp(r){return ip[r]}function mp(r){return sp[r]}function bt(r){return{fieldPath:r.canonicalString()}}function Nn(r){return ce.fromServerFormat(r.fieldPath)}function Vl(r){return r instanceof J?function(t){if("=="===t.op){if(vc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NAN"}};if(Ic(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(vc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NOT_NAN"}};if(Ic(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bt(t.field),op:fp(t.op),value:t.value}}}(r):r instanceof re?function(t){const n=t.getFilters().map(i=>Vl(i));return 1===n.length?n[0]:{compositeFilter:{op:mp(t.op),filters:n}}}(r):B()}function pp(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sl(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class mt{constructor(e,t,n,i,s=j.min(),a=j.min(),u=Ee.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new mt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class xl{constructor(e){this.ct=e}}function bl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Oi(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Pr(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:kn(s,a.version.toTimestamp()),createTime:kn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Zt(e.version)};else{if(!e.isUnknownDocument())return B();n.unknownDocument={path:t.path.toArray(),version:Zt(e.version)}}var s,a;return n}function Oi(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Zt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function en(r){const e=new fe(r.seconds,r.nanoseconds);return j.fromTimestamp(e)}function tn(r,e){const t=(e.baseMutations||[]).map(s=>lo(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>lo(r.ct,s)),i=fe.fromMillis(e.localWriteTimeMs);return new no(e.batchId,i,t,n)}function Sr(r){const e=en(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?en(r.lastLimboFreeSnapshotVersion):j.min();let n;return n=void 0!==r.query.documents?(G(1===(s=r.query).documents.length),Ce(Pn(Il(s.documents[0])))):function(s){return Ce(Rl(s))}(r.query),new mt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ee.fromBase64String(r.resumeToken));var s}function Cl(r,e){const t=Zt(e.snapshotVersion),n=Zt(e.lastLimboFreeSnapshotVersion);let i;i=Si(e.target)?Al(r.ct,e.target):Mi(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Xt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function ho(r){const e=Rl({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?bi(e,e.limit,"L"):e}function fo(r,e){return new io(e.largestBatchId,lo(r.ct,e.overlayMutation))}function Dl(r,e){const t=e.path.lastSegment();return[r,be(e.path.popLast()),t]}function kl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Zt(n.readTime),documentKey:be(n.documentKey.path),largestBatchId:n.largestBatchId}}class _p{getBundleMetadata(e,t){return Nl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:en(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Nl(e).put({bundleId:(i=t).id,createTime:Zt(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Fl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:ho(s.bundledQuery),readTime:en(s.readTime)};var s})}saveNamedQuery(e,t){return Fl(e).put({name:(i=t).name,readTime:Zt(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Nl(r){return we(r,"bundles")}function Fl(r){return we(r,"namedQueries")}class Li{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Li(e,t.uid||"")}getOverlay(e,t){return xr(e).get(Dl(this.userId,t)).next(n=>n?fo(this.serializer,n):null)}getOverlays(e,t){const n=it();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new io(t,a);i.push(this.ht(e,u))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(be(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(xr(e).j("collectionPathOverlayIndex",u))}),P.waitFor(s)}getOverlaysForCollection(e,t,n){const i=it(),s=be(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return xr(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=fo(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=it();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const g=fo(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return xr(e).put(function(i,s,a){const[u,c,h]=Dl(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Vr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function xr(r){return we(r,"documentOverlays")}class nn{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ge(e.integerValue));else if("doubleValue"in e){const n=ge(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),lr(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=ct(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(lt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Tc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):B()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),L.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function yp(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Ml(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=yp(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}nn.bt=new nn;class Ip{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{const i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){const t=this.Bt(e),n=Ml(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Bt(e),n=Ml(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class vp{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class Tp{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class br{constructor(){this.Gt=new Ip,this.zt=new vp(this.Gt),this.jt=new Tp(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class rn{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new rn(this.indexId,this.documentKey,this.arrayValue,n)}}function Ct(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Ol(r.arrayValue,e.arrayValue),0!==t?t:(t=Ol(r.directionalValue,e.directionalValue),0!==t?t:L.comparator(r.documentKey,e.documentKey)))}function Ol(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Ll{constructor(e){this.Yt=new se((t,n)=>ce.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const n=t;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(e){if(G(e.collectionGroup===this.collectionId),this.en)return!1;const t=qs(e);if(void 0!==t&&!this.nn(t))return!1;const n=$t(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){const u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.rn(u,c)||!this.sn(this.Zt[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.Zt.length||!this.sn(this.Zt[a++],n[s]))return!1;return!0}on(){if(this.en)return null;let e=new se(ce.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Qt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Qt(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Qt(n.field,"asc"===n.dir?0:1)));return new Tn(Tn.UNKNOWN_ID,this.collectionId,t,En.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Bl(r){var e,t;if(G(r instanceof J||r instanceof re),r instanceof J){if(r instanceof kc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>J.create(r.field,"==",s)))||[];return re.create(i,"or")}return r}const n=r.filters.map(i=>Bl(i));return re.create(n,r.op)}function Ep(r){if(0===r.getFilters().length)return[];const e=go(Bl(r));return G(Ul(e)),mo(e)||po(e)?[e]:e.getFilters()}function mo(r){return r instanceof J}function po(r){return r instanceof re&&Hs(r)}function Ul(r){return mo(r)||po(r)||function(t){if(t instanceof re&&Ws(t)){for(const n of t.getFilters())if(!mo(n)&&!po(n))return!1;return!0}return!1}(r)}function go(r){if(G(r instanceof J||r instanceof re),r instanceof J)return r;if(1===r.filters.length)return go(r.filters[0]);const e=r.filters.map(n=>go(n));let t=re.create(e,r.op);return t=Bi(t),Ul(t)?t:(G(t instanceof re),G(Rn(t)),G(t.filters.length>1),t.filters.reduce((n,i)=>_o(n,i)))}function _o(r,e){let t;return G(r instanceof J||r instanceof re),G(e instanceof J||e instanceof re),t=r instanceof J?e instanceof J?re.create([r,e],"and"):ql(r,e):e instanceof J?ql(e,r):function(i,s){if(G(i.filters.length>0&&s.filters.length>0),Rn(i)&&Rn(s))return bc(i,s.getFilters());const a=Ws(i)?i:s,u=Ws(i)?s:i,c=a.filters.map(h=>_o(h,u));return re.create(c,"or")}(r,e),Bi(t)}function ql(r,e){if(Rn(e))return bc(e,r.getFilters());{const t=e.filters.map(n=>_o(r,n));return re.create(t,"or")}}function Bi(r){if(G(r instanceof J||r instanceof re),r instanceof J)return r;const e=r.getFilters();if(1===e.length)return Bi(e[0]);if(Sc(r))return r;const t=e.map(i=>Bi(i)),n=[];return t.forEach(i=>{i instanceof J?n.push(i):i instanceof re&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:re.create(n,r.op)}class Ap{constructor(){this._n=new yo}addToCollectionParentIndex(e,t){return this._n.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve($e.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve($e.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class yo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new se(X.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new se(X.comparator)).toArray()}}const Ui=new Uint8Array(0);class wp{constructor(e,t){this.databaseId=t,this.an=new yo,this.un=new dt(n=>Xt(n),(n,i)=>gr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});const s={collectionId:n,parent:be(i)};return Gl(e).put(s)}return P.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Yu(t),""],!1,!0);return Gl(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(nt(a.parent))}return n})}addFieldIndex(e,t){const n=Cr(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Mn(e);return s.next(u=>{a.put(kl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Cr(e),i=Mn(e),s=Fn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Cr(e),n=Fn(e),i=Mn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return P.forEach(this.cn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Ll(n).on();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Fn(e);let i=!0;const s=new Map;return P.forEach(this.cn(t),a=>this.ln(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=W();const u=[];return P.forEach(s,(c,h)=>{var q;N("IndexedDbIndexManager",`Using index ${q=c,`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`} to execute ${Xt(t)}`);const f=function(q,K){const Y=qs(K);if(void 0===Y)return null;for(const Q of xi(q,Y.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,c),g=function(q,K){const Y=new Map;for(const Q of $t(K))for(const T of xi(q,Q.fieldPath))switch(T.op){case"==":case"in":Y.set(Q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Y.set(Q.fieldPath.canonicalString(),T.value),Array.from(Y.values())}return null}(h,c),y=function(q,K){const Y=[];let Q=!0;for(const T of $t(K)){const _=0===T.kind?Nc(q,T.fieldPath,q.startAt):Fc(q,T.fieldPath,q.startAt);Y.push(_.value),Q&&(Q=_.inclusive)}return new xt(Y,Q)}(h,c),R=function(q,K){const Y=[];let Q=!0;for(const T of $t(K)){const _=0===T.kind?Fc(q,T.fieldPath,q.endAt):Nc(q,T.fieldPath,q.endAt);Y.push(_.value),Q&&(Q=_.inclusive)}return new xt(Y,Q)}(h,c),C=this.hn(c,h,y),F=this.hn(c,h,R),k=this.Pn(c,h,g),U=this.In(c.indexId,f,C,y.inclusive,F,R.inclusive,k);return P.forEach(U,z=>n.G(z,t.limit).next(q=>{q.forEach(K=>{const Y=L.fromSegments(K.documentKey);a.has(Y)||(a=a.add(Y),u.push(Y))})}))}).next(()=>u)}return P.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Ep(re.create(e.filters,"and")).map(n=>Js(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let g=0;g<c;++g){const y=t?this.Tn(t[g/h]):Ui,R=this.En(e,y,n[g%h],i),C=this.dn(e,y,s[g%h],a),F=u.map(k=>this.En(e,y,k,!0));f.push(...this.createRange(R,C,F))}return f}En(e,t,n,i){const s=new rn(e,L.empty(),t,n);return i?s:s.Jt()}dn(e,t,n,i){const s=new rn(e,L.empty(),t,n);return i?s.Jt():s}ln(e,t){const n=new Ll(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.cn(t);return P.forEach(i,s=>this.ln(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new se(ce.comparator),f=!1;for(const g of c.filters)for(const y of g.getFlattenedFilters())y.field.isKeyField()||("array-contains"===y.op||"array-contains-any"===y.op?f=!0:h=h.add(y.field));for(const g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}An(e,t){const n=new br;for(const i of $t(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Ht(i.kind);nn.bt.Pt(s,a)}return n.Wt()}Tn(e){const t=new br;return nn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new br;return nn.bt.Pt(Ht(this.databaseId,t),n.Ht(function(s){const a=$t(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let i=[];i.push(new br);let s=0;for(const a of $t(e)){const u=n[s++];for(const c of i)if(this.Vn(t,a.fieldPath)&&fr(u))i=this.mn(i,a,u);else{const h=c.Ht(a.kind);nn.bt.Pt(u,h)}}return this.fn(i)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new br;c.seed(u.Wt()),nn.bt.Pt(a,c.Ht(t.kind)),s.push(c)}return s}Vn(e,t){return!!e.filters.find(n=>n instanceof J&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Cr(e),i=Mn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return P.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){const y=g?new En(g.sequenceNumber,new $e(en(g.readTime),new L(nt(g.documentKey)),g.largestBatchId)):En.empty(),R=f.fields.map(([C,F])=>new Qt(ce.fromServerFormat(C),F));return new Tn(f.indexId,f.collectionGroup,R,y)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:$(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Cr(e),s=Mn(e);return this.gn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>P.forEach(u,c=>s.put(kl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return P.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?P.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),P.forEach(u,c=>this.pn(e,i,c).next(h=>{const f=this.yn(s,c);return h.isEqual(f)?P.resolve():this.wn(e,s,c,h,f)}))))})}Sn(e,t,n,i){return Fn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,i){return Fn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const i=Fn(e);let s=new se(Ct);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(a,u)=>{s=s.add(new rn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(e,t){let n=new se(Ct);const i=this.An(t,e);if(null==i)return n;const s=qs(t);if(null!=s){const a=e.data.field(s.fieldPath);if(fr(a))for(const u of a.arrayValue.values||[])n=n.add(new rn(t.indexId,e.key,this.Tn(u),i))}else n=n.add(new rn(t.indexId,e.key,Ui,i));return n}wn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,g,y){const R=c.getIterator(),C=h.getIterator();let F=An(R),k=An(C);for(;F||k;){let U=!1,z=!1;if(F&&k){const q=f(F,k);q<0?z=!0:q>0&&(U=!0)}else null!=F?z=!0:U=!0;U?(g(k),k=An(C)):z?(y(F),F=An(R)):(F=An(R),k=An(C))}}(i,s,Ct,u=>{a.push(this.Sn(e,t,n,u))},u=>{a.push(this.bn(e,t,n,u))}),P.waitFor(a)}gn(e){let t=1;return Mn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>Ct(a,u)).filter((a,u,c)=>!u||0!==Ct(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=Ct(a,e),c=Ct(a,t);if(0===u)i[0]=e.Jt();else if(u>0&&c<0)i.push(a),i.push(a.Jt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ui,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ui,[]]))}return s}Dn(e,t){return Ct(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jl)}getMinOffset(e,t){return P.mapArray(this.cn(t),n=>this.ln(e,n).next(i=>i||B())).next(jl)}}function Gl(r){return we(r,"collectionParents")}function Fn(r){return we(r,"indexEntries")}function Cr(r){return we(r,"indexConfiguration")}function Mn(r){return we(r,"indexState")}function jl(r){G(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Gs(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new $e(e.readTime,e.documentKey,t)}const zl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class De{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Kl(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,g,y)=>(u++,y.delete()));s.push(c.next(()=>{G(1===u)}));const h=[];for(const f of t.mutations){const g=uc(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return P.waitFor(s).next(()=>h)}function qi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw B();e=r.noDocument}return JSON.stringify(e).length}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class Gi{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(e,t,n,i){G(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Gi(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=On(e),a=Dt(e);return a.add({}).next(u=>{G("number"==typeof u);const c=new no(u,t,n,i),h=function(R,C,F){const k=F.baseMutations.map(z=>Vr(R.ct,z)),U=F.mutations.map(z=>Vr(R.ct,z));return{userId:C,batchId:F.batchId,localWriteTimeMs:F.localWriteTime.toMillis(),baseMutations:k,mutations:U}}(this.serializer,this.userId,c),f=[];let g=new se((y,R)=>$(y.canonicalString(),R.canonicalString()));for(const y of i){const R=uc(this.userId,y.key.path,u);g=g.add(y.key.path.popLast()),f.push(a.put(h)),f.push(s.put(R,fm))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.Cn[u]=c.keys()}),P.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Dt(e).get(t).next(n=>n?(G(n.userId===this.userId),tn(this.serializer,n)):null)}vn(e,t){return this.Cn[t]?P.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Dt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(G(u.batchId>=n),s=tn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Dt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dt(e).U("userMutationsIndex",t).next(n=>n.map(i=>tn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ti(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return On(e).J({range:i},(a,u,c)=>{const[h,f,g]=a,y=nt(f);if(h===this.userId&&t.path.isEqual(y))return Dt(e).get(g).next(R=>{if(!R)throw B();G(R.userId===this.userId),s.push(tn(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new se($);const i=[];return t.forEach(s=>{const a=Ti(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=On(e).J({range:u},(h,f,g)=>{const[y,R,C]=h,F=nt(R);y===this.userId&&s.path.isEqual(F)?n=n.add(C):g.done()});i.push(c)}),P.waitFor(i).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Ti(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new se($);return On(e).J({range:a},(c,h,f)=>{const[g,y,R]=c,C=nt(y);g===this.userId&&n.isPrefixOf(C)?C.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Fn(e,u))}Fn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Dt(e).get(s).next(a=>{if(null===a)throw B();G(a.userId===this.userId),n.push(tn(this.serializer,a))}))}),P.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Kl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),P.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return On(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=nt(s[1]);i.push(c)}else u.done()}).next(()=>{G(0===i.length)})})}containsKey(e,t){return $l(e,this.userId,t)}xn(e){return Ql(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function $l(r,e,t){const n=Ti(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return On(r).J({range:s,H:!0},(u,c,h)=>{const[f,g,y]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function Dt(r){return we(r,"mutations")}function On(r){return we(r,"documentMutations")}function Ql(r){return we(r,"mutationQueues")}class sn{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new sn(0)}static Ln(){return new sn(-1)}}class Rp{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const n=new sn(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>j.fromTimestamp(new fe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ln(e).delete(t.targetId)).next(()=>this.Bn(e)).next(n=>(G(n.targetCount>0),n.targetCount-=1,this.kn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Ln(e).J((a,u)=>{const c=Sr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ln(e).J((n,i)=>{const s=Sr(i);t(s)})}Bn(e){return Wl(e).get("targetGlobalKey").next(t=>(G(null!==t),t))}kn(e,t){return Wl(e).put("targetGlobalKey",t)}qn(e,t){return Ln(e).put(Cl(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Xt(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Ln(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Sr(u);gr(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=kt(e);return t.forEach(a=>{const u=be(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),P.waitFor(i)}removeMatchingKeys(e,t,n){const i=kt(e);return P.forEach(t,s=>{const a=be(s.path);return P.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=kt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=kt(e);let s=W();return i.J({range:n,H:!0},(a,u,c)=>{const h=nt(a[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=be(t.path),i=IDBKeyRange.bound([n],[Yu(n)],!1,!0);let s=0;return kt(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Ln(e).get(t).next(n=>n?Sr(n):null)}}function Ln(r){return we(r,"targets")}function Wl(r){return we(r,"targetGlobal")}function kt(r){return we(r,"targetDocuments")}function Hl([r,e],[t,n]){const i=$(r,t);return 0===i?$(e,n):i}class Pp{constructor(e){this.Kn=e,this.buffer=new se(Hl),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Hl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){At(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Et(n)}yield t.zn(3e5)}))}}class Vp{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return P.resolve(Qe.oe);const n=new Pp(t);return this.jn.forEachTarget(e,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(zl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zl):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),In()<=et.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Sp{constructor(e,t){this.db=e,this.garbageCollector=function Jl(r,e){return new Vp(r,e)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Zn(e){let t=0;return this.Jn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(n,i)=>t(i))}addReference(e,t,n){return ji(e,n)}removeReference(e,t,n){return ji(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ji(e,t)}er(e,t){return function(i,s){let a=!1;return Ql(i).Y(u=>$l(i,u,s).next(c=>(c&&(a=!0),P.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(e,(a,u)=>{if(u<=t){const c=this.er(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,j.min()),kt(e).delete([0,be(a.path)])))});i.push(c)}}).next(()=>P.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ji(e,t)}Xn(e,t){const n=kt(e);let i,s=Qe.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==Qe.oe&&t(new L(nt(i)),s),s=h,i=c):s=Qe.oe}).next(()=>{s!==Qe.oe&&t(new L(nt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ji(r,e){return kt(r).put((i=r.currentSequenceNumber,{targetId:0,path:be(e.path),sequenceNumber:i}));var i}class Yl{constructor(){this.changes=new dt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xp{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return on(e).put(n)}removeEntry(e,t,n){return on(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Oi(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=le.newInvalidDocument(t);return on(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Dr(t))},(i,s)=>{n=this.nr(t,s)}).next(()=>n)}rr(e,t){let n={size:0,document:le.newInvalidDocument(t)};return on(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Dr(t))},(i,s)=>{n={document:this.nr(t,s),size:qi(s)}}).next(()=>n)}getEntries(e,t){let n=ze();return this.ir(e,t,(i,s)=>{const a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(e,t){let n=ze(),i=new ue(L.comparator);return this.ir(e,t,(s,a)=>{const u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,qi(a))}).next(()=>({documents:n,_r:i}))}ir(e,t,n){if(t.isEmpty())return P.resolve();let i=new se(nh);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(Dr(i.first()),Dr(i.last())),a=i.getIterator();let u=a.getNext();return on(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const g=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&nh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(Dr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Oi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return on(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{null==s||s.incrementDocumentReadCount(h.length);let f=ze();for(const g of h){const y=this.nr(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(yr(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=ze();const a=th(t,n),u=th(t,$e.max());return on(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const g=this.nr(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new bp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return eh(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}tr(e,t){return eh(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const n=function gp(r,e){let t;if(e.document)t=El(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=L.fromSegments(e.noDocument.path),i=en(e.noDocument.readTime);t=le.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{const n=L.fromSegments(e.unknownDocument.path),i=en(e.unknownDocument.version);t=le.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new fe(i[0],i[1]);return j.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(j.min()))return n}return le.newInvalidDocument(e)}}function Zl(r){return new xp(r)}class bp extends Yl{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new dt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new se((s,a)=>$(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=bl(this.ar.serializer,a);i=i.add(s.path.popLast());const h=qi(c);n+=h-u.size,t.push(this.ar.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=bl(this.ar.serializer,a.convertToNoDocument(j.min()));t.push(this.ar.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,n)),P.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(n=>(this.ur.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function eh(r){return we(r,"remoteDocumentGlobal")}function on(r){return we(r,"remoteDocumentsV14")}function Dr(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function th(r,e){const t=e.documentKey.path.toArray();return[r,Oi(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function nh(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=$(t[s],n[s]),i)return i;return i=$(t.length,n.length),i||(i=$(t[t.length-2],n[n.length-2]),i||$(t[t.length-1],n[n.length-1]))}class Cp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class rh{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Er(n.mutation,i,je.empty(),fe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,W()).next(()=>n))}getLocalViewOfDocuments(e,t,n=W()){const i=it();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Ir();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=it();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,W()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=ze();const a=vr(),u=vr();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof ft)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Er(f.mutation,h,f.mutation.getFieldMask(),fe.now())):a.set(h.key,je.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new Cp(f,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=vr();let i=new ue((a,u)=>a-u),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||je.empty();f=u.applyToLocalView(h,f),n.set(c,f);const g=(i.get(u.batchId)||W()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,g=Kc();f.forEach(y=>{if(!s.has(y)){const R=el(t.get(y),n.get(y));null!==R&&g.set(y,R),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return P.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return L.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ys(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):P.resolve(it());let u=-1,c=s;return a.next(h=>P.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,W())).next(f=>({batchId:u,changes:zc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=Ir();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=Ir();return this.indexManager.getCollectionParents(e,s).next(u=>P.forEach(u,c=>{const h=(g=t,y=c.child(s),new ht(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,y;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,y)=>{a=a.insert(g,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,le.newInvalidDocument(f)))});let u=Ir();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Er(f.mutation,h,je.empty(),fe.now()),yr(t,h)&&(u=u.insert(c,h))}),u})}}class Dp{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return P.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),P.resolve();var i}getNamedQuery(e,t){return P.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:ho(i.bundledQuery),readTime:Ie(i.readTime)}),P.resolve();var i}}class kp{constructor(){this.overlays=new ue(L.comparator),this.hr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=it();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.hr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const i=it(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ue((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=it(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=it(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return P.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new io(t,n));let s=this.hr.get(t);void 0===s&&(s=W(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class Io{constructor(){this.Pr=new se(Re.Ir),this.Tr=new se(Re.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Re(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new Re(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){const t=new L(new X([])),n=new Re(t,e),i=new Re(t,e+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new L(new X([])),n=new Re(t,e),i=new Re(t,e+1);let s=W();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Re(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Re{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return L.comparator(e.key,t.key)||$(e.pr,t.pr)}static Er(e,t){return $(e.pr,t.pr)||L.comparator(e.key,t.key)}}class Np{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new se(Re.Ir)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.yr;this.yr++;const a=new no(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.wr=this.wr.add(new Re(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Re(t,0),i=new Re(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{const u=this.Sr(a.pr);s.push(u)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new se($);return t.forEach(i=>{const s=new Re(i,0),a=new Re(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),P.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;L.isDocumentKey(s)||(s=s.child(""));const a=new Re(new L(s),0);let u=new se($);return this.wr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.pr)),!0)},a),P.resolve(this.Dr(u))}Dr(e){const t=[];return e.forEach(n=>{const i=this.Sr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){G(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return P.forEach(t.mutations,i=>{const s=new Re(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new Re(t,0),i=this.wr.firstAfterOrEqual(n);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return P.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Fp{constructor(e){this.vr=e,this.docs=new ue(L.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():le.newInvalidDocument(t))}getEntries(e,t){let n=ze();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():le.newInvalidDocument(i))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=ze();const a=t.path,u=new L(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Gs(ec(f),n)<=0||(i.has(f.key)||yr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,n,i){B()}Fr(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Mp(this)}getSize(e){return P.resolve(this.size)}}class Mp extends Yl{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Op{constructor(e){this.persistence=e,this.Mr=new dt(t=>Xt(t),gr),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Io,this.targetCount=0,this.Lr=sn.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),P.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new sn(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.qn(t),P.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Nr.containsKey(t))}}class vo{constructor(e,t){this.Br={},this.overlays={},this.kr=new Qe(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Op(this),this.indexManager=new Ap,this.remoteDocumentCache=new Fp(n=>this.referenceDelegate.Kr(n)),this.serializer=new xl(t),this.$r=new Dp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new kp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new Np(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new Lp(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return P.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class Lp extends nc{constructor(e){super(),this.currentSequenceNumber=e}}class zi{constructor(e){this.persistence=e,this.zr=new Io,this.jr=null}static Hr(e){return new zi(e)}get Jr(){if(this.jr)return this.jr;throw B()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),P.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Jr,n=>{const i=L.fromPath(n);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,j.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return P.or([()=>P.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Bp{constructor(e){this.serializer=e}O(e,t,n,i){const s=new vi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ac,{unique:!0}),c.createObjectStore("documentMutations"),ih(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=P.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),ih(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ac,{unique:!0});const g=h.store("mutations"),y=f.map(R=>g.put(R));return P.waitFor(y)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:Rm});h.createIndex("collectionPathOverlayIndex",Pm,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Vm,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:mm});h.createIndex("documentKeyIndex",pm),h.createIndex("collectionGroupIndex",gm)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Tm}).createIndex("sequenceNumberIndex",Em,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Am}).createIndex("documentKeyIndex",wm,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),a}ei(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=qi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>P.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>P.forEach(u,c=>{G(c.userId===s.userId);const h=tn(this.serializer,c);return Kl(e,s.userId,h).next(()=>{})}))}))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new X(a),h=[0,be(c)];s.push(t.get(h).next(f=>f?P.resolve():t.put({targetId:0,path:be(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>P.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:vm});const n=t.store("collectionParents"),i=new yo,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:be(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new X(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=nt(u);return s(f.popLast())}))}ri(e){const t=e.store("targets");return t.J((n,i)=>{const s=Sr(i),a=Cl(this.serializer,s);return t.put(a)})}ii(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(g=a,g.document?new L(X.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):B()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>P.waitFor(i))}si(e,t){const n=t.store("mutations"),i=Zl(this.serializer),s=new vo(zi.Hr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:W();tn(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),P.forEach(u,(c,h)=>{const f=new Ae(h),g=Li.lt(this.serializer,f),y=s.getIndexManager(f),R=Gi.lt(f,this.serializer,y,s.referenceDelegate);return new rh(i,R,g,y).recalculateAndSaveOverlaysForDocumentKeys(new Ks(t,Qe.oe),c).next()})})}}function ih(r){r.createObjectStore("targetDocuments",{keyPath:ym}).createIndex("documentTargetsIndex",Im,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",_m,{unique:!0}),r.createObjectStore("targetGlobal")}const To="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Eo{constructor(e,t,n,i,s,a,u,c,h,f,g=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=h,this.ai=f,this.ui=g,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=y=>Promise.resolve(),!Eo.D())throw new D(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Sp(this,i),this.Ti=t+"main",this.serializer=new xl(c),this.Ei=new tt(this.Ti,this.ui,new Bp(this.serializer)),this.Qr=new Rp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Zl(this.serializer),this.$r=new _p,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===f&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,To);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Qe(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var t=this;return this.Ii=function(){var n=(0,b.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(function(){var t=(0,b.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,b.A)(function*(){t.started&&(yield t.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>$i(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(At(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return kr(e).get("owner").next(t=>P.resolve(this.Si(t)))}bi(e){return $i(e).delete(this.clientId)}Di(){var e=this;return(0,b.A)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=we(n,"clientMetadata");return i.U().next(s=>{const a=e.vi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return P.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.di)for(const n of t)e.di.removeItem(e.Fi(n.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?P.resolve(!0):kr(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,To);return!1}}return!(!this.networkEnabled||!this.inForeground)||$i(e).U().next(n=>void 0===this.vi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.A)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Ks(t,Qe.oe);return e.yi(n).next(()=>e.bi(n))}),e.Ei.close(),e.Li()})()}vi(e,t){return e.filter(n=>this.Ci(n.updateTimeMs,t)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>$i(e).U().next(t=>this.vi(t,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Gi.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new wp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Li.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(c=this.ui)?xm:15===c?dc:14===c?hc:13===c?lc:12===c?Sm:11===c?cc:void B();var c;let a;return this.Ei.runTransaction(e,i,s,u=>(a=new Ks(u,this.kr?this.kr.next():Qe.oe),"readwrite-primary"===t?this.gi(a).next(c=>!!c||this.pi(a)).next(c=>{if(!c)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new D(S.FAILED_PRECONDITION,tc);return n(a)}).next(c=>this.wi(a).next(()=>c)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(e){return kr(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(S.FAILED_PRECONDITION,To)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return kr(e).put("owner",t)}static D(){return tt.D()}yi(e){const t=kr(e);return t.get("owner").next(n=>this.Si(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,ne.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function kr(r){return we(r,"owner")}function $i(r){return we(r,"clientMetadata")}function Ao(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class wo{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=W(),i=W();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new wo(e,t.fromCache,n,i)}}class Up{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,ne.nr)()?8:rc((0,ne.ZQ)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ji(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Up;return this.Ji(e,t,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(e,t,a,u.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(In()<=et.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Sn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),P.resolve()):(In()<=et.$b.DEBUG&&N("QueryEngine","Query:",Sn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(In()<=et.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Sn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ce(t))):P.resolve())}ji(e,t){if(Oc(t))return P.resolve(null);let n=Ce(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=bi(t,null,"F"),n=Ce(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=W(...s);return this.zi.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.Zi(t,u);return this.Xi(t,h,a,c.readTime)?this.ji(e,bi(t,null,"F")):this.es(e,h,t,c)}))})))}Hi(e,t,n,i){return Oc(t)||i.isEqual(j.min())?P.resolve(null):this.zi.getDocuments(e,n).next(s=>{const a=this.Zi(t,s);return this.Xi(t,a,n,i)?P.resolve(null):(In()<=et.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sn(t)),this.es(e,a,t,Zu(i,-1)).next(u=>u))})}Zi(e,t){let n=new se(Gc(e));return t.forEach((i,s)=>{yr(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return In()<=et.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Sn(t)),this.zi.getDocumentsMatchingQuery(e,t,$e.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class qp{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ue($),this.rs=new dt(s=>Xt(s),gr),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function oh(r,e,t,n){return new qp(r,e,t,n)}function ah(r,e){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,b.A)(function*(r,e){const t=M(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=W();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({us:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function uh(r){const e=M(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function ch(r,e,t){let n=W(),i=W();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=ze();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(j.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{cs:a,ls:i}})}function zp(r,e){const t=M(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Bn(r,e){const t=M(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(s=>s?(i=s,P.resolve(i)):t.Qr.allocateTargetId(n).next(a=>(i=new mt(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ns.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}function Un(r,e,t){return Po.apply(this,arguments)}function Po(){return(Po=(0,b.A)(function*(r,e,t){const n=M(r),i=n.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!At(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})).apply(this,arguments)}function Qi(r,e,t){const n=M(r);let i=j.min(),s=W();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const g=M(c),y=g.rs.get(f);return void 0!==y?P.resolve(g.ns.get(y)):g.Qr.getTargetData(h,f)}(n,a,Ce(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ts.getDocumentsMatchingQuery(a,e,t?i:j.min(),t?s:W())).next(u=>(dh(n,qc(e),u),{documents:u,hs:s})))}function lh(r,e){const t=M(r),n=M(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function hh(r,e){const t=M(r),n=t.ss.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,Zu(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(dh(t,e,i),i))}function dh(r,e,t){let n=r.ss.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(e,n)}function Vo(){return(Vo=(0,b.A)(function*(r,e,t,n){const i=M(r);let s=W(),a=ze();for(const h of t){const f=e.Ps(h.metadata.name);h.document&&(s=s.add(f));const g=e.Is(h);g.setReadTime(e.Ts(h.metadata.readTime)),a=a.insert(f,g)}const u=i.os.newChangeBuffer({trackRemovals:!0}),c=yield Bn(i,(f=n,Ce(Pn(X.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>ch(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Qr.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.cs,f.ls)).next(()=>f.cs)))})).apply(this,arguments)}function $p(r,e){return So.apply(this,arguments)}function So(){return(So=(0,b.A)(function*(r,e,t=W()){const n=yield Bn(r,Ce(ho(e.bundledQuery))),i=M(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ie(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.$r.saveNamedQuery(s,e);const u=n.withResumeToken(Ee.EMPTY_BYTE_STRING,a);return i.ns=i.ns.insert(u.targetId,u),i.Qr.updateTargetData(s,u).next(()=>i.Qr.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Qr.addMatchingKeys(s,t,n.targetId)).next(()=>i.$r.saveNamedQuery(s,e))})})).apply(this,arguments)}function fh(r,e){return`firestore_clients_${r}_${e}`}function mh(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function xo(r,e){return`firestore_targets_${r}_${e}`}class Wi{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Es(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new D(i.error.code,i.error.message))),a?new Wi(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Nr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new D(n.error.code,n.error.message))),s?new Nr(e,n.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Hi{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=eo();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=sc(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new Hi(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class bo{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new bo(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Co{constructor(){this.activeTargetIds=eo()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Do{constructor(e,t,n,i,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ue($),this.started=!1,this.ys=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=fh(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Co),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.A)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Vs)continue;const s=e.getItem(fh(e.persistenceKey,i));if(s){const a=Hi.Es(i,s);a&&(e.ps=e.ps.insert(a.clientId,a))}}e.Ms();const n=e.storage.getItem(e.vs);if(n){const i=e.xs(n);i&&e.Os(i)}for(const i of e.ys)e.gs(i);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(xo(this.persistenceKey,e));if(n){const i=Nr.Es(e,n);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(xo(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ws)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,b.A)(function*(){if(t.started){if(null!==n.key)if(t.bs.test(n.key)){if(null==n.newValue){const i=t.$s(n.key);return t.Us(i,null)}{const i=t.Ws(n.key,n.newValue);if(i)return t.Us(i.clientId,i)}}else if(t.Ds.test(n.key)){if(null!==n.newValue){const i=t.Gs(n.key,n.newValue);if(i)return t.zs(i)}}else if(t.Cs.test(n.key)){if(null!==n.newValue){const i=t.js(n.key,n.newValue);if(i)return t.Hs(i)}}else if(n.key===t.vs){if(null!==n.newValue){const i=t.xs(n.newValue);if(i)return t.Os(i)}}else if(n.key===t.Ss){const i=function(a){let u=Qe.oe;if(null!=a)try{const c=JSON.parse(a);G("number"==typeof c),u=c}catch(c){ye("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==Qe.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Fs){const i=t.Js(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ys(s)))}}else t.ys.push(n)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){const i=new Wi(this.currentUser,e,t,n),s=mh(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){const t=mh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,t,n){const i=xo(this.persistenceKey,e),s=new Nr(e,t,n);this.setItem(i,s.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return Hi.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),i=Number(n[1]);return Wi.Es(new Ae(void 0!==n[2]?n[2]:null),i,t)}js(e,t){const n=this.Cs.exec(e),i=Number(n[1]);return Nr.Es(i,t)}xs(e){return bo.Es(e)}Js(e){return JSON.parse(e)}zs(e){var t=this;return(0,b.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Zs(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=eo();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class ph{constructor(){this.no=new Co,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Co,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Qp{io(e){}shutdown(){}}class gh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Xi=null;function ko(){return null===Xi?Xi=268435456+Math.round(2147483648*Math.random()):Xi++,"0x"+Xi.toString(16)}const Wp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Hp{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const ke="WebChannelConnection";class Xp extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,n,i,s,a){const u=ko(),c=this.vo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(h,s,a),this.Mo(t,c,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ge("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}xo(t,n,i,s,a,u){return this.Co(t,n,i,s,a)}Fo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+yn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}vo(t,n){return`${this.wo}/v1/${n}:${Wp[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){const s=ko();return new Promise((a,u)=>{const c=new Gu;c.setWithCredentials(!0),c.listenOnce(zu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ii.NO_ERROR:const f=c.getResponseJson();N(ke,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case Ii.TIMEOUT:N(ke,`RPC '${e}' ${s} timed out`),u(new D(S.DEADLINE_EXCEEDED,"Request time out"));break;case Ii.HTTP_ERROR:const g=c.getStatus();if(N(ke,`RPC '${e}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let y=c.getResponseJson();Array.isArray(y)&&(y=y[0]);const R=null==y?void 0:y.error;if(R&&R.status&&R.message){const C=function(k){const U=k.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(U)>=0?U:S.UNKNOWN}(R.status);u(new D(C,R.message))}else u(new D(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new D(S.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{N(ke,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(ke,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Oo(e,t,n){const i=ko(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Qu(),u=$u(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new ju({})),this.Fo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");N(ke,`Creating RPC '${e}' stream ${i}: ${f}`,c);const g=a.createWebChannel(f,c);let y=!1,R=!1;const C=new Hp({lo:k=>{R?N(ke,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(y||(N(ke,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),N(ke,`RPC '${e}' stream ${i} sending:`,k),g.send(k))},ho:()=>g.close()}),F=(k,U,z)=>{k.listen(U,q=>{try{z(q)}catch(K){setTimeout(()=>{throw K},0)}})};return F(g,or.EventType.OPEN,()=>{R||(N(ke,`RPC '${e}' stream ${i} transport opened.`),C.mo())}),F(g,or.EventType.CLOSE,()=>{R||(R=!0,N(ke,`RPC '${e}' stream ${i} transport closed`),C.po())}),F(g,or.EventType.ERROR,k=>{R||(R=!0,Ge(ke,`RPC '${e}' stream ${i} transport errored:`,k),C.po(new D(S.UNAVAILABLE,"The operation could not be completed")))}),F(g,or.EventType.MESSAGE,k=>{var U;if(!R){const z=k.data[0];G(!!z);const K=z.error||(null===(U=z[0])||void 0===U?void 0:U.error);if(K){N(ke,`RPC '${e}' stream ${i} received error:`,K);const Y=K.status;let Q=function(v){const E=ve[v];if(void 0!==E)return al(E)}(Y),T=K.message;void 0===Q&&(Q=S.INTERNAL,T="Unknown error status: "+Y+" with message "+K.message),R=!0,C.po(new D(Q,T)),g.close()}else N(ke,`RPC '${e}' stream ${i} received:`,z),C.yo(z)}}),F(u,Ku.STAT_EVENT,k=>{k.stat===Bs.PROXY?N(ke,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===Bs.NOPROXY&&N(ke,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{C.fo()},0),C}}function _h(){return typeof window<"u"?window:null}function Ji(){return typeof document<"u"?document:null}function Fr(r){return new op(r,!0)}class No{constructor(e,t,n=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class yh{constructor(e,t,n,i,s,a,u,c){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new No(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}stop(){var e=this;return(0,b.A)(function*(){e.Zo()&&(yield e.close(0))})()}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){var e=this;return(0,b.A)(function*(){if(e.Xo())return e.close(0)})()}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.s_(),n.o_(),n.Yo.cancel(),n.jo++,4!==e?n.Yo.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.Yo.Ko()):t&&t.code===S.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.__(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ao(t)})()}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{const i=new D(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){var e=this;this.state=5,this.Yo.$o((0,b.A)(function*(){e.state=0,e.start()}))}c_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Jp extends yh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function cp(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:B(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(G(void 0===f||"string"==typeof f),Ee.fromBase64String(f||"")):(G(void 0===f||f instanceof Buffer||f instanceof Uint8Array),Ee.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?S.UNKNOWN:al(h.code);return new D(f,h.message||"")}(a);t=new dl(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=st(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):j.min(),u=new Ve({mapValue:{fields:n.document.fields}}),c=le.newFoundDocument(i,s,a,u);t=new Fi(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=st(r,n.document),s=n.readTime?Ie(n.readTime):j.min(),a=le.newNoDocument(i,s);t=new Fi([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=st(r,n.document);t=new Fi([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return B();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new ep(i,s);t=new hl(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return j.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?Ie(a.readTime):j.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=co(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=Si(c)?{documents:Al(s,c)}:{query:Mi(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=gl(s,a.resumeToken);const h=oo(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(j.min())>0){u.readTime=kn(s,a.snapshotVersion.toTimestamp());const h=oo(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function hp(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=co(this.serializer),t.removeTarget=e,this.i_(t)}}class Yp extends yh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function lp(r,e){return r&&r.length>0?(G(void 0!==e),r.map(t=>function(i,s){let a=Ie(i.updateTime?i.updateTime:s);return a.isEqual(j.min())&&(a=Ie(s)),new Jm(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.A_(n,t)}return G(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=co(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Vr(this.serializer,n))};this.i_(t)}}class Zp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,uo(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(S.UNKNOWN,s.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(e,uo(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(S.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class eg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ye(t),this.y_=!1):N("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class tg{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(u=>{n.enqueueAndForget((0,b.A)(function*(){var c;Nt(a)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,b.A)(function*(f){const g=M(f);g.M_.add(4),yield qn(g),g.N_.set("Unknown"),g.M_.delete(4),yield Mr(g)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.N_=new eg(n,i)}}function Mr(r){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,b.A)(function*(r){if(Nt(r))for(const e of r.x_)yield e(!0)})).apply(this,arguments)}function qn(r){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,b.A)(function*(r){for(const e of r.x_)yield e(!1)})).apply(this,arguments)}function Yi(r,e){const t=M(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Bo(t)?Lo(t):zn(t).Xo()&&Oo(t,e))}function Gn(r,e){const t=M(r),n=zn(t);t.F_.delete(e),n.Xo()&&Ih(t,e),0===t.F_.size&&(n.Xo()?n.n_():Nt(t)&&t.N_.set("Unknown"))}function Oo(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zn(r).P_(e)}function Ih(r,e){r.L_.xe(e),zn(r).I_(e)}function Lo(r){r.L_=new np({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),zn(r).start(),r.N_.w_()}function Bo(r){return Nt(r)&&!zn(r).Zo()&&r.F_.size>0}function Nt(r){return 0===M(r).M_.size}function vh(r){r.L_=void 0}function ng(r){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,b.A)(function*(r){r.N_.set("Online")})).apply(this,arguments)}function rg(r){return qo.apply(this,arguments)}function qo(){return(qo=(0,b.A)(function*(r){r.F_.forEach((e,t)=>{Oo(r,e)})})).apply(this,arguments)}function ig(r,e){return Go.apply(this,arguments)}function Go(){return(Go=(0,b.A)(function*(r,e){vh(r),Bo(r)?(r.N_.D_(e),Lo(r)):r.N_.set("Unknown")})).apply(this,arguments)}function sg(r,e,t){return jo.apply(this,arguments)}function jo(){return jo=(0,b.A)(function*(r,e,t){if(r.N_.set("Online"),e instanceof dl&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.F_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.F_.delete(c),s.L_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Zi(r,n)}else if(e instanceof Fi?r.L_.Ke(e):e instanceof hl?r.L_.He(e):r.L_.We(e),!t.isEqual(j.min()))try{const n=yield uh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.L_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.F_.get(h);f&&s.F_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.F_.get(c);if(!f)return;s.F_.set(c,f.withResumeToken(Ee.EMPTY_BYTE_STRING,f.snapshotVersion)),Ih(s,c);const g=new mt(f.target,c,h,f.sequenceNumber);Oo(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Zi(r,n)}var n}),jo.apply(this,arguments)}function Zi(r,e,t){return zo.apply(this,arguments)}function zo(){return(zo=(0,b.A)(function*(r,e,t){if(!At(e))throw e;r.M_.add(1),yield qn(r),r.N_.set("Offline"),t||(t=()=>uh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield Mr(r)}))})).apply(this,arguments)}function Th(r,e){return e().catch(t=>Zi(r,t,e))}function jn(r){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,b.A)(function*(r){const e=M(r),t=Ft(e);let n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;og(e);)try{const i=yield zp(e.localStore,n);if(null===i){0===e.v_.length&&t.n_();break}n=i.batchId,ag(e,i)}catch(i){yield Zi(e,i)}Eh(e)&&Ah(e)})).apply(this,arguments)}function og(r){return Nt(r)&&r.v_.length<10}function ag(r,e){r.v_.push(e);const t=Ft(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function Eh(r){return Nt(r)&&!Ft(r).Zo()&&r.v_.length>0}function Ah(r){Ft(r).start()}function ug(r){return $o.apply(this,arguments)}function $o(){return($o=(0,b.A)(function*(r){Ft(r).V_()})).apply(this,arguments)}function cg(r){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,b.A)(function*(r){const e=Ft(r);for(const t of r.v_)e.d_(t.mutations)})).apply(this,arguments)}function lg(r,e,t){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,b.A)(function*(r,e,t){const n=r.v_.shift(),i=ro.from(n,e,t);yield Th(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield jn(r)})).apply(this,arguments)}function hg(r,e){return Ho.apply(this,arguments)}function Ho(){return Ho=(0,b.A)(function*(r,e){var t;e&&Ft(r).E_&&(yield(t=(0,b.A)(function*(i,s){if(ol(u=s.code)&&u!==S.ABORTED){const a=i.v_.shift();Ft(i).t_(),yield Th(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield jn(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),Eh(r)&&Ah(r)}),Ho.apply(this,arguments)}function wh(r,e){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,b.A)(function*(r,e){const t=M(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=Nt(t);t.M_.add(3),yield qn(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Mr(t)})).apply(this,arguments)}function Jo(r,e){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,b.A)(function*(r,e){const t=M(r);e?(t.M_.delete(2),yield Mr(t)):e||(t.M_.add(2),yield qn(t),t.N_.set("Unknown"))})).apply(this,arguments)}function zn(r){return r.B_||(r.B_=function(t,n,i){const s=M(t);return s.f_(),new Jp(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:ng.bind(null,r),To:rg.bind(null,r),Ao:ig.bind(null,r),h_:sg.bind(null,r)}),r.x_.push(function(){var e=(0,b.A)(function*(t){t?(r.B_.t_(),Bo(r)?Lo(r):r.N_.set("Unknown")):(yield r.B_.stop(),vh(r))});return function(t){return e.apply(this,arguments)}}())),r.B_}function Ft(r){return r.k_||(r.k_=function(t,n,i){const s=M(t);return s.f_(),new Yp(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:ug.bind(null,r),Ao:hg.bind(null,r),R_:cg.bind(null,r),A_:lg.bind(null,r)}),r.x_.push(function(){var e=(0,b.A)(function*(t){t?(r.k_.t_(),yield jn(r)):(yield r.k_.stop(),r.v_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))});return function(t){return e.apply(this,arguments)}}())),r.k_}class Zo{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Zo(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new D(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kn(r,e){if(ye("AsyncQueue",`${e}: ${r}`),At(r))return new D(S.UNAVAILABLE,`${e}: ${r}`);throw r}class $n{constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=Ir(),this.sortedSet=new ue(this.comparator)}static emptySet(e){return new $n(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $n)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new $n;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Rh{constructor(){this.q_=new ue(L.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):B():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Qn{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new Qn(e,t,$n.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_r(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class dg{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class fg{constructor(){this.queries=new dt(e=>Uc(e),_r),this.onlineState="Unknown",this.z_=new Set}}function ea(r,e){return ta.apply(this,arguments)}function ta(){return(ta=(0,b.A)(function*(r,e){const t=M(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(n=2):(s=new dg,n=e.G_()?0:1);try{switch(n){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=Kn(a,`Initialization of query '${Sn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&ia(t)})).apply(this,arguments)}function na(r,e){return ra.apply(this,arguments)}function ra(){return(ra=(0,b.A)(function*(r,e){const t=M(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.U_.indexOf(e);a>=0&&(s.U_.splice(a,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function mg(r,e){const t=M(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&ia(t)}function pg(r,e,t){const n=M(r),i=n.queries.get(e);if(i)for(const s of i.U_)s.onError(t);n.queries.delete(e)}function ia(r){r.z_.forEach(e=>{e.next()})}var sa,Ph;(Ph=sa||(sa={})).J_="default",Ph.Cache="cache";class oa{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Qn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==sa.Cache}}class gg{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class Vh{constructor(e){this.serializer=e}Ps(e){return st(this.serializer,e)}Is(e){return e.metadata.exists?El(this.serializer,e.document,!1):le.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Ie(e)}}class _g{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Sh(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const n=X.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,n=new Vh(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Ps(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||W()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,b.A)(function*(){const t=yield function Kp(r,e,t,n){return Vo.apply(this,arguments)}(e.localStore,new Vh(e.serializer),e.documents,e.oa.id),n=e.aa(e.documents);for(const i of e.queries)yield $p(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function Sh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class xh{constructor(e){this.key=e}}class bh{constructor(e){this.key=e}}class Ch{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=W(),this.mutatedKeys=W(),this.Ia=Gc(e),this.Ta=new $n(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new Rh,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const y=i.get(f),R=yr(this.query,g)?g:null,C=!!y&&this.mutatedKeys.has(y.key),F=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let k=!1;y&&R?y.data.isEqual(R.data)?C!==F&&(n.track({type:3,doc:R}),k=!0):this.Ra(y,R)||(n.track({type:2,doc:R}),k=!0,(c&&this.Ia(R,c)>0||h&&this.Ia(R,h)<0)&&(u=!0)):!y&&R?(n.track({type:0,doc:R}),k=!0):y&&!R&&(n.track({type:1,doc:y}),k=!0,(c||h)&&(u=!0)),k&&(R?(a=a.add(R),s=F?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const a=e.Aa.Q_();a.sort((f,g)=>function(R,C){const F=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return F(R)-F(C)}(f.type,g.type)||this.Ia(f.doc,g.doc)),this.Va(n),i=null!=i&&i;const u=t&&!i?this.ma():[],c=0===this.Pa.size&&this.current&&!i?1:0,h=c!==this.ha;return this.ha=c,0!==a.length||h?{snapshot:new Qn(this.query,e.Ta,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Rh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=W(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});const t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new bh(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new xh(n))}),t}pa(e){this.la=e.hs,this.Pa=W();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Qn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class yg{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ig{constructor(e){this.key=e,this.wa=!1}}class vg{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new dt(u=>Uc(u),_r),this.Da=new Map,this.Ca=new Set,this.va=new ue(L.comparator),this.Fa=new Map,this.Ma=new Io,this.xa={},this.Oa=new Map,this.Na=sn.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function Tg(r,e){return aa.apply(this,arguments)}function aa(){return(aa=(0,b.A)(function*(r,e,t=!0){const n=es(r);let i;const s=n.ba.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Dh(n,e,t,!0),i})).apply(this,arguments)}function Eg(r,e){return ua.apply(this,arguments)}function ua(){return(ua=(0,b.A)(function*(r,e){const t=es(r);yield Dh(t,e,!0,!1)})).apply(this,arguments)}function Dh(r,e,t,n){return ca.apply(this,arguments)}function ca(){return(ca=(0,b.A)(function*(r,e,t,n){const i=yield Bn(r.localStore,Ce(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield la(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Yi(r.remoteStore,i),u})).apply(this,arguments)}function la(r,e,t,n,i){return ha.apply(this,arguments)}function ha(){return ha=(0,b.A)(function*(r,e,t,n,i){r.Ba=(g,y,R)=>{return(C=(0,b.A)(function*(k,U,z,q){let K=U.view.da(z);K.Xi&&(K=yield Qi(k.localStore,U.query,!1).then(({documents:_})=>U.view.da(_,K)));const Y=q&&q.targetChanges.get(U.targetId),Q=q&&null!=q.targetMismatches.get(U.targetId),T=U.view.applyChanges(K,k.isPrimaryClient,Y,Q);return Ea(k,U.targetId,T.fa),T.snapshot}),function F(k,U,z,q){return C.apply(this,arguments)})(r,g,y,R);var C};const s=yield Qi(r.localStore,e,!0),a=new Ch(e,s.hs),u=a.da(s.documents),c=Rr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);Ea(r,t,h.fa);const f=new yg(e,t,a);return r.ba.set(e,f),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),h.snapshot}),ha.apply(this,arguments)}function Ag(r,e,t){return da.apply(this,arguments)}function da(){return(da=(0,b.A)(function*(r,e,t){const n=M(r),i=n.ba.get(e),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!_r(a,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Un(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Gn(n.remoteStore,i.targetId),Wn(n,i.targetId)}).catch(Et))):(Wn(n,i.targetId),yield Un(n.localStore,i.targetId,!0))})).apply(this,arguments)}function wg(r,e){return fa.apply(this,arguments)}function fa(){return(fa=(0,b.A)(function*(r,e){const t=M(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gn(t.remoteStore,n.targetId))})).apply(this,arguments)}function ma(){return(ma=(0,b.A)(function*(r,e,t){const n=ka(r);try{const i=yield function(a,u){const c=M(a),h=fe.now(),f=u.reduce((R,C)=>R.add(C.key),W());let g,y;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let C=ze(),F=W();return c.os.getEntries(R,f).next(k=>{C=k,C.forEach((U,z)=>{z.isValidDocument()||(F=F.add(U))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,C)).next(k=>{g=k;const U=[];for(const z of u){const q=Zm(z,g.get(z.key).overlayedDocument);null!=q&&U.push(new ft(z.key,q,wc(q.value.mapValue),me.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,U,u)}).next(k=>{y=k;const U=k.applyToLocalDocumentSet(g,F);return c.documentOverlayCache.saveOverlays(R,k.batchId,U)})}).then(()=>({batchId:y.batchId,changes:zc(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.xa[a.currentUser.toKey()];h||(h=new ue($)),h=h.insert(u,c),a.xa[a.currentUser.toKey()]=h}(n,i.batchId,t),yield pt(n,i.changes),yield jn(n.remoteStore)}catch(i){const s=Kn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function kh(r,e){return pa.apply(this,arguments)}function pa(){return(pa=(0,b.A)(function*(r,e){const t=M(r);try{const n=yield function jp(r,e){const t=M(r),n=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const u=[];e.targetChanges.forEach((f,g)=>{const y=i.get(g);if(!y)return;u.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,g)));let R=y.withSequenceNumber(s.currentSequenceNumber);var F,k,U;null!==e.targetMismatches.get(g)?R=R.withResumeToken(Ee.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),k=R,U=f,(0===(F=y).resumeToken.approximateByteSize()||k.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=3e8||U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0)&&u.push(t.Qr.updateTargetData(s,R))});let c=ze(),h=W();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(ch(s,a,e.documentUpdates).next(f=>{c=f.cs,h=f.ls})),!n.isEqual(j.min())){const f=t.Qr.getLastRemoteSnapshotVersion(s).next(g=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return P.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Fa.get(s);a&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?G(a.wa):i.removedDocuments.size>0&&(G(a.wa),a.wa=!1))}),yield pt(t,n,e)}catch(n){yield Et(n)}})).apply(this,arguments)}function Nh(r,e,t){const n=M(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.ba.forEach((s,a)=>{const u=a.view.j_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=M(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(const y of g.U_)y.j_(u)&&(h=!0)}),h&&ia(c)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Pg(r,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,b.A)(function*(r,e,t){const n=M(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Fa.get(e),s=i&&i.key;if(s){let a=new ue(L.comparator);a=a.insert(s,le.newNoDocument(s,j.min()));const u=W().add(s),c=new wr(j.min(),new Map,new ue($),a,u);yield kh(n,c),n.va=n.va.remove(s),n.Fa.delete(e),Aa(n)}else yield Un(n.localStore,e,!1).then(()=>Wn(n,e,t)).catch(Et)})).apply(this,arguments)}function Vg(r,e){return _a.apply(this,arguments)}function _a(){return(_a=(0,b.A)(function*(r,e){const t=M(r),n=e.batch.batchId;try{const i=yield function Gp(r,e){const t=M(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const g=h.batch,y=g.keys();let R=P.resolve();return y.forEach(C=>{R=R.next(()=>f.getEntry(c,C)).next(F=>{const k=h.docVersions.get(C);G(null!==k),F.version.compareTo(k)<0&&(g.applyToRemoteDocument(F,h),F.isValidDocument()&&(F.setReadTime(h.commitVersion),f.addEntry(F)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=W();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Ta(t,n,null),va(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield pt(t,i)}catch(i){yield Et(i)}})).apply(this,arguments)}function Sg(r,e,t){return ya.apply(this,arguments)}function ya(){return(ya=(0,b.A)(function*(r,e,t){const n=M(r);try{const i=yield function(a,u){const c=M(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(G(null!==g),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);Ta(n,e,t),va(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield pt(n,i)}catch(i){yield Et(i)}})).apply(this,arguments)}function Ia(){return(Ia=(0,b.A)(function*(r,e){const t=M(r);Nt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=M(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Oa.get(n)||[];i.push(e),t.Oa.set(n,i)}catch(n){const i=Kn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function va(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function Ta(r,e,t){const n=M(r);let i=n.xa[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function Wn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||Fh(r,n)})}function Fh(r,e){r.Ca.delete(e.path.canonicalString());const t=r.va.get(e);null!==t&&(Gn(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),Aa(r))}function Ea(r,e,t){for(const n of t)n instanceof xh?(r.Ma.addReference(n.key,e),bg(r,n)):n instanceof bh?(N("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||Fh(r,n.key)):B()}function bg(r,e){const t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(N("SyncEngine","New document in limbo: "+t),r.Ca.add(n),Aa(r))}function Aa(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){const e=r.Ca.values().next().value;r.Ca.delete(e);const t=new L(X.fromString(e)),n=r.Na.next();r.Fa.set(n,new Ig(t)),r.va=r.va.insert(t,n),Yi(r.remoteStore,new mt(Ce(Pn(t.path)),n,"TargetPurposeLimboResolution",Qe.oe))}}function pt(r,e,t){return wa.apply(this,arguments)}function wa(){return wa=(0,b.A)(function*(r,e,t){const n=M(r),i=[],s=[],a=[];var u;n.ba.isEmpty()||(n.ba.forEach((u,c)=>{a.push(n.Ba(c,e,t).then(h=>{if((h||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(c.targetId,h&&!h.fromCache?"current":"not-current"),h){i.push(h);const f=wo.Ki(c.targetId,h);s.push(f)}}))}),yield Promise.all(a),n.Sa.h_(i),yield(u=(0,b.A)(function*(h,f){const g=M(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>P.forEach(f,R=>P.forEach(R.qi,C=>g.persistence.referenceDelegate.addReference(y,R.targetId,C)).next(()=>P.forEach(R.Qi,C=>g.persistence.referenceDelegate.removeReference(y,R.targetId,C)))))}catch(y){if(!At(y))throw y;N("LocalStore","Failed to update sequence numbers: "+y)}for(const y of f){const R=y.targetId;if(!y.fromCache){const C=g.ns.get(R),k=C.withLastLimboFreeSnapshotVersion(C.snapshotVersion);g.ns=g.ns.insert(R,k)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),wa.apply(this,arguments)}function Cg(r,e){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,b.A)(function*(r,e){const t=M(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield ah(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(u=>{u.forEach(c=>{c.reject(new D(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield pt(t,n.us)}var s})).apply(this,arguments)}function Dg(r,e){const t=M(r),n=t.Fa.get(e);if(n&&n.wa)return W().add(n.key);{let i=W();const s=t.Da.get(e);if(!s)return i;for(const a of s){const u=t.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function kg(r,e){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,b.A)(function*(r,e){const t=M(r),n=yield Qi(t.localStore,e.query,!0),i=e.view.pa(n);return t.isPrimaryClient&&Ea(t,e.targetId,i.fa),i})).apply(this,arguments)}function Ng(r,e){return Va.apply(this,arguments)}function Va(){return(Va=(0,b.A)(function*(r,e){const t=M(r);return hh(t.localStore,e).then(n=>pt(t,n))})).apply(this,arguments)}function Fg(r,e,t,n){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r,e,t,n){const i=M(r),s=yield function(u,c){const h=M(u),f=M(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.vn(g,c).next(y=>y?h.localDocuments.getDocuments(g,y):P.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield jn(i.remoteStore):"acknowledged"===t||"rejected"===t?(Ta(i,e,n||null),va(i,e),c=e,M(M(i.localStore).mutationQueue).Mn(c)):B(),yield pt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function xa(){return(xa=(0,b.A)(function*(r,e){const t=M(r);if(es(t),ka(t),!0===e&&!0!==t.La){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Mh(t,n.toArray());t.La=!0,yield Jo(t.remoteStore,!0);for(const s of i)Yi(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const n=[];let i=Promise.resolve();t.Da.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Wn(t,a),Un(t.localStore,a,!0))),Gn(t.remoteStore,a)}),yield i,yield Mh(t,n),function(a){const u=M(a);u.Fa.forEach((c,h)=>{Gn(u.remoteStore,h)}),u.Ma.mr(),u.Fa=new Map,u.va=new ue(L.comparator)}(t),t.La=!1,yield Jo(t.remoteStore,!1)}})).apply(this,arguments)}function Mh(r,e,t){return ba.apply(this,arguments)}function ba(){return(ba=(0,b.A)(function*(r,e,t){const n=M(r),i=[],s=[];for(const a of e){let u;const c=n.Da.get(a);if(c&&0!==c.length){u=yield Bn(n.localStore,Ce(c[0]));for(const h of c){const f=n.ba.get(h),g=yield kg(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield lh(n.localStore,a);u=yield Bn(n.localStore,h),yield la(n,Oh(h),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})).apply(this,arguments)}function Oh(r){return Mc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Og(r){return t=M(r).localStore,M(M(t).persistence).Bi();var t}function Lg(r,e,t,n){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,b.A)(function*(r,e,t,n){const i=M(r);if(i.La)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield hh(i.localStore,qc(s[0])),u=wr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ee.EMPTY_BYTE_STRING);yield pt(i,a,u);break}case"rejected":yield Un(i.localStore,e,!0),Wn(i,e,n);break;default:B()}})).apply(this,arguments)}function Bg(r,e,t){return Da.apply(this,arguments)}function Da(){return(Da=(0,b.A)(function*(r,e,t){const n=es(r);if(n.La){for(const i of e){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield lh(n.localStore,i),a=yield Bn(n.localStore,s);yield la(n,Oh(s),a.targetId,!1,a.resumeToken),Yi(n.remoteStore,a)}for(const i of t)n.Da.has(i)&&(yield Un(n.localStore,i,!1).then(()=>{Gn(n.remoteStore,i),Wn(n,i)}).catch(Et))}})).apply(this,arguments)}function es(r){const e=M(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=kh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Dg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Pg.bind(null,e),e.Sa.h_=mg.bind(null,e.eventManager),e.Sa.ka=pg.bind(null,e.eventManager),e}function ka(r){const e=M(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Sg.bind(null,e),e}class Hn{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,b.A)(function*(){t.serializer=Fr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return oh(this.persistence,new sh,e.initialUser,this.serializer)}createPersistence(e){return new vo(zi.Hr,this.serializer)}createSharedClientState(e){return new ph}terminate(){var e=this;return(0,b.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Na extends Hn{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e),yield n.Qa.initialize(n,e),yield ka(n.Qa.syncEngine),yield jn(n.Qa.remoteStore),yield n.persistence.fi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return oh(this.persistence,new sh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Xl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new hm(t,this.persistence);return new lm(e.asyncQueue,n)}createPersistence(e){const t=Ao(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new Eo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,_h(),Ji(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new ph}}class Lh extends Na{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e);const i=n.Qa.syncEngine;n.sharedClientState instanceof Do&&(n.sharedClientState.syncEngine={Zs:Fg.bind(null,i),Xs:Lg.bind(null,i),eo:Bg.bind(null,i),Bi:Og.bind(null,i),Ys:Ng.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.fi(function(){var s=(0,b.A)(function*(a){yield function Mg(r,e){return xa.apply(this,arguments)}(n.Qa.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=_h();if(!Do.D(t))throw new D(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ao(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Do(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Xn{initialize(e,t){var n=this;return(0,b.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Nh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Cg.bind(null,n.syncEngine),yield Jo(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new fg}createDatastore(e){const t=Fr(e.databaseInfo.databaseId),n=new Xp(e.databaseInfo);return new Zp(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Nh(this.syncEngine,t,0),u=gh.D()?new gh:new Qp,new tg(n,i,s,a,u);var n,i,s,a,u}createSyncEngine(e,t){return function(i,s,a,u,c,h,f){const g=new vg(i,s,a,u,c,h);return f&&(g.La=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,b.A)(function*(){var t,n;yield(n=(0,b.A)(function*(s){const a=M(s);N("RemoteStore","RemoteStore shutting down."),a.M_.add(5),yield qn(a),a.O_.shutdown(),a.N_.set("Unknown")}),function i(s){return n.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function Bh(r,e=10240){let t=0;return{read:()=>(0,b.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,b.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ts{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Gg{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Te,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==n?void 0:n.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,b.A)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,b.A)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,b.A)(function*(){const t=yield e.za();if(null===t)return null;const n=e.Wa.decode(t),i=Number(n);isNaN(i)&&e.ja(`length string (${n}) is not valid number`);const s=yield e.Ha(i);return new gg(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>123===e)}za(){var e=this;return(0,b.A)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Ha(e){var t=this;return(0,b.A)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const n=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,b.A)(function*(){const t=yield e.Ua.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class jg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new D(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,b.A)(function*(a,u){const c=M(a),h={documents:u.map(R=>Pr(c.serializer,R))},f=yield c.xo("BatchGetDocuments",c.serializer.databaseId,X.emptyPath(),h,u.length),g=new Map;f.forEach(R=>{const C=function up(r,e){return"found"in e?function(n,i){G(!!i.found);const s=st(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):j.min(),c=new Ve({mapValue:{fields:i.found.fields}});return le.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){G(!!i.missing),G(!!i.readTime);const s=st(n,i.missing),a=Ie(i.readTime);return le.newNoDocument(s,a)}(r,e):B()}(c.serializer,R);g.set(C.key.toString(),C)});const y=[];return u.forEach(R=>{const C=g.get(R.toString());G(!!C),y.push(C)}),y}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Dn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=L.fromPath(i);e.mutations.push(new to(s,e.precondition(s)))}),yield(n=(0,b.A)(function*(s,a){const u=M(s),c={writes:a.map(h=>Vr(u.serializer,h))};yield u.Co("Commit",u.serializer.databaseId,X.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=j.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?me.exists(!1):me.updateTime(t):me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new D(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(t)}return me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class zg{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new No(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Yo.$o((0,b.A)(function*(){const t=new jg(e.datastore),n=e.tu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!cr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ol(t)}return!1}}class Kg{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=Ju.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var a=(0,b.A)(function*(u){N("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(n,a=>(N("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Kn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ns(r,e){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield ah(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Fa.apply(this,arguments)}function Ma(r,e){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield La(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>wh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>wh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Uh(r){return"FirebaseError"===r.name?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function La(r){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ns(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Uh(t))throw t;Ge("Error using user provided cache. Falling back to memory cache: "+t),yield ns(r,new Hn)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield ns(r,new Hn);return r._offlineComponents})).apply(this,arguments)}function rs(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ma(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Ma(r,new Xn))),r._onlineComponents})).apply(this,arguments)}function qh(r){return La(r).then(e=>e.persistence)}function Jn(r){return La(r).then(e=>e.localStore)}function Gh(r){return rs(r).then(e=>e.remoteStore)}function qa(r){return rs(r).then(e=>e.syncEngine)}function Yn(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,b.A)(function*(r){const e=yield rs(r),t=e.eventManager;return t.onListen=Tg.bind(null,e.syncEngine),t.onUnlisten=Ag.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Eg.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wg.bind(null,e.syncEngine),t})).apply(this,arguments)}function zh(r,e,t={}){const n=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new ts({next:y=>{a.enqueueAndForget(()=>na(s,g));const R=y.docs.has(u);!R&&y.fromCache?h.reject(new D(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&y.fromCache&&c&&"server"===c.source?h.reject(new D(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new oa(Pn(u.path),f,{includeMetadataChanges:!0,ra:!0});return ea(s,g)}(yield Yn(r),r.asyncQueue,e,t,n)})),n.promise}function Kh(r,e,t={}){const n=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new ts({next:y=>{a.enqueueAndForget(()=>na(s,g)),y.fromCache&&"server"===c.source?h.reject(new D(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new oa(u,f,{includeMetadataChanges:!0,ra:!0});return ea(s,g)}(yield Yn(r),r.asyncQueue,e,t,n)})),n.promise}function $h(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Qh=new Map;function ja(r,e,t){if(!t)throw new D(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Wh(r,e,t,n){if(!0===e&&!0===n)throw new D(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Hh(r){if(!L.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Xh(r){if(L.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function is(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":B()}function H(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new D(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=is(r);throw new D(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Jh(r,e){if(e<=0)throw new D(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Yh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new D(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Wh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=$h(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Or{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new D(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Yf;switch(n.type){case"firstParty":return new nm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Qh.get(t);n&&(N("ComponentProvider","Removing Datastore"),Qh.delete(t),n.terminate())}(this),Promise.resolve()}}class Se{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Se(this.firestore,e,this._query)}}class he{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new he(this.firestore,e,this._key)}}class ot extends Se{constructor(e,t,n){super(e,t,Pn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new L(e))}withConverter(e){return new ot(this.firestore,e,this._path)}}function ed(r,e,...t){if(r=(0,ne.Ku)(r),ja("collection","path",e),r instanceof Or){const n=X.fromString(e,...t);return Xh(n),new ot(r,null,n)}{if(!(r instanceof he||r instanceof ot))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(X.fromString(e,...t));return Xh(n),new ot(r.firestore,null,n)}}function ss(r,e,...t){if(r=(0,ne.Ku)(r),1===arguments.length&&(e=Ju.newId()),ja("doc","path",e),r instanceof Or){const n=X.fromString(e,...t);return Hh(n),new he(r,null,new L(n))}{if(!(r instanceof he||r instanceof ot))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(X.fromString(e,...t));return Hh(n),new he(r.firestore,r instanceof ot?r.converter:null,new L(n))}}function td(r,e){return r=(0,ne.Ku)(r),e=(0,ne.Ku)(e),(r instanceof he||r instanceof ot)&&(e instanceof he||e instanceof ot)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function za(r,e){return r=(0,ne.Ku)(r),e=(0,ne.Ku)(e),r instanceof Se&&e instanceof Se&&r.firestore===e.firestore&&_r(r._query,e._query)&&r.converter===e.converter}class i_{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new No(this,"async_queue_retry"),this.hu=()=>{const t=Ji();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const e=Ji();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Ji();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new Te;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,b.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Yo.reset()}catch(t){if(!At(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Yo.$o(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{throw this.au=n,this.uu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=Zo.createAndSchedule(this,e,t,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&B()}verifyOperationInProgress(){}du(){var e=this;return(0,b.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Ka(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class s_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Te,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class oe extends Or{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new i_,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||nd(this),this._firestoreClient.terminate()}}function pe(r){return r._firestoreClient||nd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function nd(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Dm(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,$h(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new Kg(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function rd(r,e,t){const n=new Te;return r.asyncQueue.enqueue((0,b.A)(function*(){try{yield ns(r,t),yield Ma(r,e),n.resolve()}catch(i){const s=i;if(!Uh(s))throw s;Ge("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function id(r){if(r._initialized||r._terminated)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class at{constructor(e){this._byteString=e}static fromBase64String(e){try{return new at(Ee.fromBase64String(e))}catch(t){throw new D(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new at(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new D(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class an{constructor(e){this._methodName=e}}class os{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}}const g_=/^__.*__$/;class __{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ft(e,this.data,this.fieldMask,t,this.fieldTransforms):new Cn(e,this.data,t,this.fieldTransforms)}}class sd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ft(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function od(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}class as{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new as(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return ls(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(od(this.fu)&&g_.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class y_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Fr(e)}Fu(e,t,n,i=!1){return new as({fu:e,methodName:t,vu:n,path:ce.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function un(r){const e=r._freezeSettings(),t=Fr(r._databaseId);return new y_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function us(r,e,t,n,i,s={}){const a=r.Fu(s.merge||s.mergeFields?2:0,e,t,i);Ya("Data must be an object, but it was:",a,n);const u=cd(n,a);let c,h;if(s.merge)c=new je(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const y=Ur(e,g,t);if(!a.contains(y))throw new D(S.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);hd(f,y)||f.push(y)}c=new je(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new __(new Ve(u),c,h)}class Br extends an{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Br}}function ad(r,e,t){return new as({fu:3,vu:e.settings.vu,methodName:r._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class $a extends an{_toFieldTransform(e){return new Tr(e.path,new xn)}isEqual(e){return e instanceof $a}}class Qa extends an{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=ad(this,e,!0),n=this.Mu.map(s=>cn(s,t)),i=new Jt(n);return new Tr(e.path,i)}isEqual(e){return e instanceof Qa&&(0,ne.bD)(this.Mu,e.Mu)}}class Wa extends an{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=ad(this,e,!0),n=this.Mu.map(s=>cn(s,t)),i=new Yt(n);return new Tr(e.path,i)}isEqual(e){return e instanceof Wa&&(0,ne.bD)(this.Mu,e.Mu)}}class Ha extends an{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new bn(e.serializer,Wc(e.serializer,this.xu));return new Tr(e.path,t)}isEqual(e){return e instanceof Ha&&this.xu===e.xu}}function Xa(r,e,t,n){const i=r.Fu(1,e,t);Ya("Data must be an object, but it was:",i,n);const s=[],a=Ve.empty();wt(n,(c,h)=>{const f=cs(e,c,t);h=(0,ne.Ku)(h);const g=i.Su(f);if(h instanceof Br)s.push(f);else{const y=cn(h,g);null!=y&&(s.push(f),a.set(f,y))}});const u=new je(s);return new sd(a,u,i.fieldTransforms)}function Ja(r,e,t,n,i,s){const a=r.Fu(1,e,t),u=[Ur(e,n,t)],c=[i];if(s.length%2!=0)throw new D(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)u.push(Ur(e,s[y])),c.push(s[y+1]);const h=[],f=Ve.empty();for(let y=u.length-1;y>=0;--y)if(!hd(h,u[y])){const R=u[y];let C=c[y];C=(0,ne.Ku)(C);const F=a.Su(R);if(C instanceof Br)h.push(R);else{const k=cn(C,F);null!=k&&(h.push(R),f.set(R,k))}}const g=new je(h);return new sd(f,g,a.fieldTransforms)}function ud(r,e,t,n=!1){return cn(t,r.Fu(n?4:3,e))}function cn(r,e){if(ld(r=(0,ne.Ku)(r)))return Ya("Unsupported field value:",e,r),cd(r,e);if(r instanceof an)return function(n,i){if(!od(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=cn(u,i.bu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ne.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Wc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=fe.fromDate(n);return{timestampValue:kn(i.serializer,s)}}if(n instanceof fe){const s=new fe(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:kn(i.serializer,s)}}if(n instanceof os)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof at)return{bytesValue:gl(i.serializer,n._byteString)};if(n instanceof he){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ao(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${is(n)}`)}(r,e)}function cd(r,e){const t={};return pc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wt(r,(n,i)=>{const s=cn(i,e.pu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function ld(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof fe||r instanceof os||r instanceof at||r instanceof he||r instanceof an)}function Ya(r,e,t){if(!ld(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=is(t);throw e.Du("an object"===n?r+" a custom object":r+" "+n)}var i}function Ur(r,e,t){if((e=(0,ne.Ku)(e))instanceof gt)return e._internalPath;if("string"==typeof e)return cs(r,e);throw ls("Field path arguments must be of type string or ",r,!1,void 0,t)}const I_=new RegExp("[~\\*/\\[\\]]");function cs(r,e,t){if(e.search(I_)>=0)throw ls(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new gt(...e.split("."))._internalPath}catch{throw ls(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ls(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new D(S.INVALID_ARGUMENT,u+r+c)}function hd(r,e){return r.some(t=>t.isEqual(e))}class qr{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new v_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(hs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class v_ extends qr{data(){return super.data()}}function hs(r,e){return"string"==typeof e?cs(r,e):e instanceof gt?e._internalPath:e._delegate._internalPath}function dd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new D(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Za{}class Gr extends Za{}function Mt(r,e,...t){let n=[];e instanceof Za&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Zn).length,u=s.filter(c=>c instanceof jr).length;if(a>1||a>0&&u>0)throw new D(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class jr extends Gr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new jr(e,t,n)}_apply(e){const t=this._parse(e);return gd(e._query,t),new Se(e.firestore,e.converter,Zs(e._query,t))}_parse(e){const t=un(e.firestore);return function(s,a,u,c,h,f,g){let y;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new D(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){pd(g,f);const R=[];for(const C of g)R.push(md(c,s,C));y={arrayValue:{values:R}}}else y=md(c,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||pd(g,f),y=ud(u,"where",g,"in"===f||"not-in"===f);return J.create(h,f,y)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Zn extends Za{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Zn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:re.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)gd(a,c),a=Zs(a,c)}(e._query,t),new Se(e.firestore,e.converter,Zs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class eu extends Gr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new eu(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pr(s,a)}(e._query,this._field,this._direction);return new Se(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new ht(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class ds extends Gr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ds(e,t,n)}_apply(e){return new Se(e.firestore,e.converter,bi(e._query,this._limit,this._limitType))}}class fs extends Gr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fs(e,t,n)}_apply(e){const t=fd(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class ms extends Gr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ms(e,t,n)}_apply(e){const t=fd(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function fd(r,e,t,n){if(t[0]=(0,ne.Ku)(t[0]),t[0]instanceof qr)return function(s,a,u,c,h){if(!c)throw new D(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of Vn(s))if(g.field.isKeyField())f.push(Ht(a,c.key));else{const y=c.data.field(g.field);if(Ai(y))throw new D(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===y){const R=g.field.canonicalString();throw new D(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(y)}return new xt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=un(r.firestore);return function(a,u,c,h,f,g){const y=a.explicitOrderBy;if(f.length>y.length)throw new D(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let C=0;C<f.length;C++){const F=f[C];if(y[C].field.isKeyField()){if("string"!=typeof F)throw new D(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof F}`);if(!Ys(a)&&-1!==F.indexOf("/"))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${F}' contains a slash.`);const k=a.path.child(X.fromString(F));if(!L.isDocumentKey(k))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const U=new L(k);R.push(Ht(u,U))}else{const k=ud(c,h,F);R.push(k)}}return new xt(R,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function md(r,e,t){if("string"==typeof(t=(0,ne.Ku)(t))){if(""===t)throw new D(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ys(e)&&-1!==t.indexOf("/"))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(X.fromString(t));if(!L.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ht(r,new L(n))}if(t instanceof he)return Ht(r,t._key);throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${is(t)}.`)}function pd(r,e){if(!Array.isArray(r)||0===r.length)throw new D(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gd(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new D(S.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class tu{convertValue(e,t="none"){switch(Vt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(lt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return wt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new os(ge(e.latitude),ge(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=wi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hr(e));default:return null}}convertTimestamp(e){const t=ct(e);return new fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=X.fromString(e);G(Sl(n));const i=new Rt(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ps(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class x_ extends tu{constructor(e){super(),this.firestore=e}convertBytes(e){return new at(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}class ln{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _t extends qr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new zr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(hs("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class zr extends _t{data(e={}){return super.data(e)}}class Ot{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ln(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new zr(this._firestore,this._userDataWriter,n.key,n,new ln(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new zr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new zr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:C_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function C_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function yd(r,e){return r instanceof _t&&e instanceof _t?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ot&&e instanceof Ot&&r._firestore===e._firestore&&za(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Lt extends tu{constructor(e){super(),this.firestore=e}convertBytes(e){return new at(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}function Id(r,e,t){r=H(r,he);const n=H(r.firestore,oe),i=ps(r.converter,e,t);return er(n,[us(un(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,me.none())])}function vd(r,e,t,...n){r=H(r,he);const i=H(r.firestore,oe),s=un(i);let a;return a="string"==typeof(e=(0,ne.Ku)(e))||e instanceof gt?Ja(s,"updateDoc",r._key,e,t,n):Xa(s,"updateDoc",r._key,e),er(i,[a.toMutation(r._key,me.exists(!0))])}function Td(r,...e){var t,n,i;r=(0,ne.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Ka(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ka(e[a])){const g=e[a];e[a]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,f;if(r instanceof he)h=H(r.firestore,oe),f=Pn(r._key.path),c={next:g=>{e[a]&&e[a](nu(h,r,g))},error:e[a+1],complete:e[a+2]};else{const g=H(r,Se);h=H(g.firestore,oe),f=g._query;const y=new Lt(h);c={next:R=>{e[a]&&e[a](new Ot(h,y,g,R))},error:e[a+1],complete:e[a+2]},dd(r._query)}return function(y,R,C,F){const k=new ts(F),U=new oa(R,k,C);return y.asyncQueue.enqueueAndForget((0,b.A)(function*(){return ea(yield Yn(y),U)})),()=>{k.$a(),y.asyncQueue.enqueueAndForget((0,b.A)(function*(){return na(yield Yn(y),U)}))}}(pe(h),f,u,c)}function er(r,e){return function(n,i){const s=new Te;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Rg(r,e,t){return ma.apply(this,arguments)}(yield qa(n),i,s)})),s.promise}(pe(r),e)}function nu(r,e,t){const n=t.docs.get(e._key),i=new Lt(r);return new _t(r,i,e._key,n,new ln(t.hasPendingWrites,t.fromCache),e.converter)}const H_={maxAttempts:5};class Ed{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=un(e)}set(e,t,n){this._verifyNotCommitted();const i=Bt(e,this._firestore),s=ps(i.converter,t,n),a=us(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,me.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Bt(e,this._firestore);let a;return a="string"==typeof(t=(0,ne.Ku)(t))||t instanceof gt?Ja(this._dataReader,"WriteBatch.update",s._key,t,n,i):Xa(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Bt(e,this._firestore);return this._mutations=this._mutations.concat(new Dn(t._key,me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Bt(r,e){if((r=(0,ne.Ku)(r)).firestore!==e)throw new D(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class X_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=un(t)}get(t){const n=Bt(t,this._firestore),i=new x_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return B();const a=s[0];if(a.isFoundDocument())return new qr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new qr(this._firestore,i,n._key,null,n.converter);throw B()})}set(t,n,i){const s=Bt(t,this._firestore),a=ps(s.converter,n,i),u=us(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Bt(t,this._firestore);let u;return u="string"==typeof(n=(0,ne.Ku)(n))||n instanceof gt?Ja(this._dataReader,"Transaction.update",a._key,n,i,s):Xa(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Bt(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Bt(e,this._firestore),n=new Lt(this._firestore);return super.get(e).then(i=>new _t(this._firestore,n,t._key,i._document,new ln(!1,!1),t.converter))}}function iu(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new D("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Pd(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function Vd(){if(!function bm(){return typeof atob<"u"}())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){yn=_i.SDK_VERSION,(0,_i._registerComponent)(new Lu.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new oe(new em(n.getProvider("auth-internal")),new rm(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rt(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,_i.registerVersion)(Wu,"4.6.3",e),(0,_i.registerVersion)(Wu,"4.6.3","esm2017")}();class Kr{constructor(e){this._delegate=e}static fromBase64String(e){return Vd(),new Kr(at.fromBase64String(e))}static fromUint8Array(e){return Pd(),new Kr(at.fromUint8Array(e))}toBase64(){return Vd(),this._delegate.toBase64()}toUint8Array(){return Pd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function su(r){return function oy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class ay{enableIndexedDbPersistence(e,t){return function a_(r,e){id(r=H(r,oe));const t=pe(r);if(t._uninitializedComponentsProvider)throw new D(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Xn;return rd(t,i,new Na(i,n.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function u_(r){id(r=H(r,oe));const e=pe(r);if(e._uninitializedComponentsProvider)throw new D(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Xn;return rd(e,n,new Lh(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function c_(r){if(r._initialized&&!r._terminated)throw new D(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Te;return r._queue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{yield(t=(0,b.A)(function*(i){if(!tt.D())return Promise.resolve();const s=i+"main";yield tt.delete(s)}),function n(i){return t.apply(this,arguments)})(Ao(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Sd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Rt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ge("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function Zh(r,e,t,n={}){var i;const s=(r=H(r,Or))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ae.MOCK_USER;else{u=(0,ne.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new D(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ae(h)}r._authCredentials=new Zf(new Hu(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function h_(r){return function $g(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield qh(r),t=yield Gh(r);return e.setNetworkEnabled(!0),function(i){const s=M(i);return s.M_.delete(0),Mr(s)}(t)}))}(pe(r=H(r,oe)))}(this._delegate)}disableNetwork(){return function d_(r){return function Qg(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield qh(r),t=yield Gh(r);return e.setNetworkEnabled(!1),(n=(0,b.A)(function*(s){const a=M(s);a.M_.add(0),yield qn(a),a.N_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(pe(r=H(r,oe)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Wh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function l_(r){return function(t){const n=new Te;return t.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function xg(r,e){return Ia.apply(this,arguments)}(yield qa(t),n)})),n.promise}(pe(r=H(r,oe)))}(this._delegate)}onSnapshotsInSync(e){return function U_(r,e){return function Jg(r,e){const t=new ts(e);return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Yn(r),s=t,M(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Yn(r),s=t,void M(i).z_.delete(s);var i,s}))}}(pe(r=H(r,oe)),Ka(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new tr(this,ed(this._delegate,e))}catch(t){throw Le(t,"collection()","Firestore.collection()")}}doc(e){try{return new Xe(this,ss(this._delegate,e))}catch(t){throw Le(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Be(this,function r_(r,e){if(r=H(r,Or),ja("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Se(r,null,(n=e,new ht(X.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Le(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function J_(r,e,t){r=H(r,oe);const n=Object.assign(Object.assign({},H_),t);return function(s){if(s.maxAttempts<1)throw new D(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new Te;return s.asyncQueue.enqueueAndForget((0,b.A)(function*(){const h=yield function jh(r){return rs(r).then(e=>e.datastore)}(s);new zg(s.asyncQueue,h,u,a,c).Xa()})),c.promise}(pe(r),i=>e(new X_(r,i)),n)}(this._delegate,t=>e(new xd(this,t)))}batch(){return pe(this._delegate),new bd(new Ed(this._delegate,e=>er(this._delegate,e)))}loadBundle(e){return function f_(r,e){const t=pe(r=H(r,oe)),n=new s_;return function Yg(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?ul().encode(a):a,f=function(f,g){if(f instanceof Uint8Array)return Bh(f,g);if(f instanceof ArrayBuffer)return Bh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Gg(f,u);var f}(t,Fr(e));r.asyncQueue.enqueueAndForget((0,b.A)(function*(){!function Ug(r,e,t){const n=M(r);var i;(i=(0,b.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(C,F){const k=M(C),U=Ie(F.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",z=>k.$r.getBundleMetadata(z,F.id)).then(z=>!!z&&z.createTime.compareTo(U)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(C=h).totalDocuments,bytesLoaded:C.totalBytes,totalDocuments:C.totalDocuments,totalBytes:C.totalBytes}),Promise.resolve(new Set);c._updateProgress(Sh(h));const f=new _g(h,a.localStore,u.serializer);let g=yield u.qa();for(;g;){const R=yield f._a(g);R&&c._updateProgress(R),g=yield u.qa()}const y=yield f.complete();return yield pt(a,y.ca,void 0),yield function(C,F){const k=M(C);return k.persistence.runTransaction("Save bundle","readwrite",U=>k.$r.saveBundleMetadata(U,F))}(a.localStore,h),c._completeWith(y.progress),Promise.resolve(y.ua)}catch(h){return Ge("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var C}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield qa(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function m_(r,e){return function Zg(r,e){return r.asyncQueue.enqueue((0,b.A)(function*(){return function(n,i){const s=M(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield Jn(r),e)}))}(pe(r=H(r,oe)),e).then(t=>t?new Se(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Be(this,t):null)}}class _s extends tu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kr(new at(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Xe.forKey(t,this.firestore,null)}}class xd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}get(e){const t=dn(e);return this._delegate.get(t).then(n=>new $r(this._firestore,new _t(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=dn(e);return n?(iu("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=dn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=dn(e);return this._delegate.delete(t),this}}class bd{constructor(e){this._delegate=e}set(e,t,n){const i=dn(e);return n?(iu("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=dn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=dn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class hn{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new zr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Qr(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=hn.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new hn(e,new _s(e),t),i.set(t,s)),s}}hn.INSTANCES=new WeakMap;class Xe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}static forPath(e,t,n){if(e.length%2!=0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Xe(t,new he(t._delegate,n,new L(e)))}static forKey(e,t,n){return new Xe(t,new he(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new tr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new tr(this.firestore,ed(this._delegate,e))}catch(t){throw Le(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ne.Ku)(e))instanceof he&&td(this._delegate,e)}set(e,t){t=iu("DocumentReference.set",t);try{return t?Id(this._delegate,e,t):Id(this._delegate,e)}catch(n){throw Le(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?vd(this._delegate,e):vd(this._delegate,e,t,...n)}catch(i){throw Le(i,"updateDoc()","DocumentReference.update()")}}delete(){return function L_(r){return er(H(r.firestore,oe),[new Dn(r._key,me.none())])}(this._delegate)}onSnapshot(...e){const t=Cd(e),n=Dd(e,i=>new $r(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Td(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function k_(r){r=H(r,he);const e=H(r.firestore,oe),t=pe(e),n=new Lt(e);return function Wg(r,e){const t=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield function(f,g){const y=M(f);return y.persistence.runTransaction("read document","readonly",R=>y.localDocuments.getDocument(R,g))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new D(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=Kn(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Jn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new _t(e,n,r._key,i,new ln(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function N_(r){r=H(r,he);const e=H(r.firestore,oe);return zh(pe(e),r._key,{source:"server"}).then(t=>nu(e,r,t))}(this._delegate):function D_(r){r=H(r,he);const e=H(r.firestore,oe);return zh(pe(e),r._key).then(t=>nu(e,r,t))}(this._delegate),t.then(n=>new $r(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new Xe(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}function Le(r,e,t){return r.message=r.message.replace(e,t),r}function Cd(r){for(const e of r)if("object"==typeof e&&!su(e))return e;return{}}function Dd(r,e){var t,n;let i;return i=su(r[0])?r[0]:su(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class $r{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Xe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return yd(this._delegate,e._delegate)}}class Qr extends $r{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Jf(r,e){r||B()}(void 0!==t),t}}class Be{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}where(e,t,n){try{return new Be(this.firestore,Mt(this._delegate,function T_(r,e,t){const n=e,i=hs("where",r);return jr._create(i,n,t)}(e,t,n)))}catch(i){throw Le(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Be(this.firestore,Mt(this._delegate,function E_(r,e="asc"){const t=e,n=hs("orderBy",r);return eu._create(n,t)}(e,t)))}catch(n){throw Le(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Be(this.firestore,Mt(this._delegate,function A_(r){return Jh("limit",r),ds._create("limit",r,"F")}(e)))}catch(t){throw Le(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Be(this.firestore,Mt(this._delegate,function w_(r){return Jh("limitToLast",r),ds._create("limitToLast",r,"L")}(e)))}catch(t){throw Le(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Be(this.firestore,Mt(this._delegate,function R_(...r){return fs._create("startAt",r,!0)}(...e)))}catch(t){throw Le(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Be(this.firestore,Mt(this._delegate,function P_(...r){return fs._create("startAfter",r,!1)}(...e)))}catch(t){throw Le(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Be(this.firestore,Mt(this._delegate,function V_(...r){return ms._create("endBefore",r,!1)}(...e)))}catch(t){throw Le(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Be(this.firestore,Mt(this._delegate,function S_(...r){return ms._create("endAt",r,!0)}(...e)))}catch(t){throw Le(t,"endAt()","Query.endAt()")}}isEqual(e){return za(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function M_(r){r=H(r,Se);const e=H(r.firestore,oe),t=pe(e),n=new Lt(e);return function Hg(r,e){const t=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield Qi(s,a,!0),h=new Ch(a,c.hs),f=h.da(c.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(c){const h=Kn(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Jn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ot(e,n,r,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function O_(r){r=H(r,Se);const e=H(r.firestore,oe),t=pe(e),n=new Lt(e);return Kh(t,r._query,{source:"server"}).then(i=>new Ot(e,n,r,i))}(this._delegate):function F_(r){r=H(r,Se);const e=H(r.firestore,oe),t=pe(e),n=new Lt(e);return dd(r._query),Kh(t,r._query).then(i=>new Ot(e,n,r,i))}(this._delegate),t.then(n=>new ou(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Cd(e),n=Dd(e,i=>new ou(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Td(this._delegate,t,n)}withConverter(e){return new Be(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}class cy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Qr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class ou{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Be(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Qr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new cy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Qr(this._firestore,n))})}isEqual(e){return yd(this._delegate,e._delegate)}}class tr extends Be{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Xe(this.firestore,e):null}doc(e){try{return new Xe(this.firestore,void 0===e?ss(this._delegate):ss(this._delegate,e))}catch(t){throw Le(t,"doc()","CollectionReference.doc()")}}add(e){return function B_(r,e){const t=H(r.firestore,oe),n=ss(r),i=ps(r.converter,e);return er(t,[us(un(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,me.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new Xe(this.firestore,t))}isEqual(e){return td(this._delegate,e._delegate)}withConverter(e){return new tr(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}function dn(r){return H(r,he)}class au{constructor(...e){this._delegate=new gt(...e)}static documentId(){return new au(ce.keyField().canonicalString())}isEqual(e){return(e=(0,ne.Ku)(e))instanceof gt&&this._delegate._internalPath.isEqual(e._internalPath)}}class fn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Z_(){return new $a("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new fn(e)}static delete(){const e=function Y_(){return new Br("deleteField")}();return e._methodName="FieldValue.delete",new fn(e)}static arrayUnion(...e){const t=function ey(...r){return new Qa("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new fn(t)}static arrayRemove(...e){const t=function ty(...r){return new Wa("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new fn(t)}static increment(e){const t=function ny(r){return new Ha("increment",r)}(e);return t._methodName="FieldValue.increment",new fn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const ly={Firestore:Sd,GeoPoint:os,Timestamp:fe,Blob:Kr,Transaction:xd,WriteBatch:bd,DocumentReference:Xe,DocumentSnapshot:$r,Query:Be,QueryDocumentSnapshot:Qr,QuerySnapshot:ou,CollectionReference:tr,FieldPath:au,FieldValue:fn,setLogLevel:function uy(r){!function Xf(r){Tt.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function kd(r,e){return function fy(r,e=zf.E){return new Kf.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=n&&n()}})}(r,e)}function uu(r,e){return kd(r,e).pipe((0,Ze.T)(t=>({payload:t,type:"query"})))}!function dy(r){(function hy(r,e){r.INTERNAL.registerComponent(new Lu.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},ly)))})(r,(e,t)=>new Sd(e,t,new ay)),r.registerVersion("@firebase/firestore-compat","0.3.32")}(Hf.A),ee(7935);class Nd{constructor(e,t){(0,He.A)(this,"ref",void 0),(0,He.A)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Ld(n,t);return new Od(i,s,this.afs)}snapshotChanges(){return function my(r,e){return kd(r,e).pipe((0,Ms.Z)(void 0),Os(),(0,Ze.T)(t=>{const[n,i]=t;return i.exists?null!=n&&n.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ze.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,gi.H)(this.ref.get(e)).pipe(Ke.U0)}}function ys(r,e){return uu(r,e).pipe((0,Ms.Z)(void 0),Os(),(0,Ze.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=null==n?void 0:n.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Fd(r,e,t){return ys(r,t).pipe((0,Ls.S)((n,i)=>function py(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function gy(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return cu(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return cu(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cu(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,Wf.F)(),(0,Ze.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function cu(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Md(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Od{constructor(e,t,n){(0,He.A)(this,"ref",void 0),(0,He.A)(this,"query",void 0),(0,He.A)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=ys(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ze.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Ms.Z)(void 0),Os(),(0,Ou.p)(([n,i])=>i.length>0||!n),(0,Ze.T)(([,n])=>n),Ke.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ls.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Md(e);return Fd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return uu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),Ke.U0)}get(e){return(0,gi.H)(this.query.get(e)).pipe(Ke.U0)}add(e){return this.ref.add(e)}doc(e){return new Nd(this.ref.doc(e),this.afs)}}class _y{constructor(e,t){(0,He.A)(this,"query",void 0),(0,He.A)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ys(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Ou.p)(t=>t.length>0),Ke.U0):ys(this.query,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ls.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Md(e);return Fd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return uu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ke.U0)}get(e){return(0,gi.H)(this.query.get(e)).pipe(Ke.U0)}}const yy=new p.nKC("angularfire2.enableFirestorePersistence"),Iy=new p.nKC("angularfire2.firestore.persistenceSettings"),vy=new p.nKC("angularfire2.firestore.settings"),Ty=new p.nKC("angularfire2.firestore.use-emulator");function Ld(r,e=(t=>t)){return{query:e(r),ref:r}}let Bd=(()=>{var r;class e{constructor(n,i,s,a,u,c,h,f,g,y,R,C,F,k,U,z,q){(0,He.A)(this,"schedulers",void 0),(0,He.A)(this,"firestore",void 0),(0,He.A)(this,"persistenceEnabled$",void 0),this.schedulers=h;const K=(0,pi.iB)(n,c,i),Y=g;y&&(0,Ye.gF)(K,c,R,F,k,U,C,z),[this.firestore,this.persistenceEnabled$]=(0,pi.BM)(`${K.name}.firestore`,"AngularFirestore",K.name,()=>{const Q=c.runOutsideAngular(()=>K.firestore());if(a&&Q.settings(a),Y&&Q.useEmulator(...Y),s&&!(0,fi.Vy)(u)){const T=()=>{try{return(0,gi.H)(Q.enablePersistence(f||void 0).then(()=>!0,()=>!1))}catch(_){return typeof console<"u"&&console.warn(_),(0,Mu.of)(!1)}};return[Q,c.runOutsideAngular(T)]}return[Q,(0,Mu.of)(!1)]},[a,Y,s])}collection(n,i){let s;s="string"==typeof n?this.firestore.collection(n):n;const{ref:a,query:u}=Ld(s,i),c=this.schedulers.ngZone.run(()=>a);return new Od(c,u,this)}collectionGroup(n,i){const s=i||(u=>u),a=this.firestore.collectionGroup(n);return new _y(s(a),this)}doc(n){let i;i="string"==typeof n?this.firestore.doc(n):n;const s=this.schedulers.ngZone.run(()=>i);return new Nd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return r=e,(0,He.A)(e,"\u0275fac",function(n){return new(n||r)(p.KVO(pi.rx),p.KVO(pi.uP,8),p.KVO(yy,8),p.KVO(vy,8),p.KVO(p.Agw),p.KVO(p.SKi),p.KVO(Ke.u0),p.KVO(Iy,8),p.KVO(Ty,8),p.KVO(Ye.DS,8),p.KVO(Ye.CP,8),p.KVO(Ye.yy,8),p.KVO(Ye.ZP,8),p.KVO(Ye.$z,8),p.KVO(Ye.AU,8),p.KVO(Ye.UB,8),p.KVO(Ke.Jv,8))}),(0,He.A)(e,"\u0275prov",p.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})),e})(),Ud=(()=>{var r;class e{constructor(n){this.firestore=n}getUsers(){return this.firestore.collection("users").snapshotChanges()}getUserById(n){return this.firestore.collection("users").snapshotChanges()}addIUserInfo(n){return this.firestore.collection("users").add(n)}updateUser(n,i){return this.firestore.collection("users").doc(i).update(n)}}return(r=e).\u0275fac=function(n){return new(n||r)(p.KVO(Bd))},r.\u0275prov=p.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})();var Ey=ee(5794);let Ay=(()=>{var r;class e{constructor(n){this.firestore=n}getPost(){return this.firestore.collection("publicar",n=>n.orderBy("timestamp","desc")).snapshotChanges()}update(n,i){return this.firestore.collection("publicar").doc(n).update(i)}addPost(n){return this.firestore.collection("publicar").add(n)}delete(n){return this.firestore.collection("publicar").doc(n).delete()}}return(r=e).\u0275fac=function(n){return new(n||r)(p.KVO(Bd))},r.\u0275prov=p.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})();const wy=["modal"];function Ry(r,e){if(1&r){const t=p.RV6();p.j41(0,"div")(1,"div")(2,"div",14)(3,"div",15)(4,"img",16),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.verUsuario(i.uid))}),p.k0s(),p.j41(5,"div",17),p.EFF(6),p.k0s()(),p.j41(7,"div",14)(8,"span",18),p.bIt("click",function(){p.eBV(t);const i=p.XpG(),s=i.$implicit,a=i.index,u=p.XpG();return p.Njj(u.opciones(a,s))}),p.EFF(9,"\u22ee"),p.k0s()()(),p.j41(10,"div")(11,"div"),p.nrm(12,"img",19),p.k0s(),p.j41(13,"div",20)(14,"div",21)(15,"ion-icon",22),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.abrirCom2(i))}),p.k0s(),p.j41(16,"span"),p.EFF(17),p.k0s()(),p.j41(18,"div",21)(19,"ion-icon",23),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.likeImage2(i))}),p.k0s(),p.j41(20,"span"),p.EFF(21),p.k0s()()()()()()}if(2&r){const t=p.XpG().$implicit,n=p.XpG();p.R7$(4),p.Y8G("src",t.foto,p.B4B),p.R7$(2),p.SpI(" ",t.usuario," "),p.R7$(6),p.Y8G("src",t.post,p.B4B),p.R7$(5),p.JRh(t.commentsVideo.length),p.R7$(2),p.AVh("liked",t.likedByImage.includes(n.currentUser.uid)),p.R7$(2),p.JRh(t.likesCountImage)}}function Py(r,e){if(1&r){const t=p.RV6();p.j41(0,"div",24)(1,"div",25)(2,"div",14)(3,"div",26)(4,"img",16),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.verUsuario(i.uid))}),p.k0s(),p.j41(5,"div",27),p.EFF(6),p.k0s()(),p.j41(7,"div",14)(8,"span",18),p.bIt("click",function(){p.eBV(t);const i=p.XpG(),s=i.$implicit,a=i.index,u=p.XpG();return p.Njj(u.opciones(a,s))}),p.EFF(9,"\u22ee"),p.k0s()()(),p.j41(10,"div")(11,"div"),p.EFF(12),p.k0s(),p.j41(13,"div",20)(14,"div",21)(15,"ion-icon",22),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.abrirCom2(i))}),p.k0s(),p.j41(16,"span"),p.EFF(17),p.k0s()(),p.j41(18,"div",21)(19,"ion-icon",23),p.bIt("click",function(){p.eBV(t);const i=p.XpG().$implicit,s=p.XpG();return p.Njj(s.likeImage2(i))}),p.k0s(),p.j41(20,"span"),p.EFF(21),p.k0s()()()()()()}if(2&r){const t=p.XpG().$implicit,n=p.XpG();p.R7$(4),p.Y8G("src",t.foto,p.B4B),p.R7$(2),p.SpI(" ",t.usuario," "),p.R7$(6),p.SpI(" ",t.post," "),p.R7$(5),p.JRh(t.commentsVideo.length),p.R7$(2),p.AVh("liked",t.likedByImage.includes(n.currentUser.uid)),p.R7$(2),p.JRh(t.likesCountImage)}}function Vy(r,e){if(1&r&&(p.j41(0,"div")(1,"div"),p.DNE(2,Ry,22,7,"div",12)(3,Py,22,7,"div",13),p.k0s()()),2&r){const t=e.$implicit,n=p.XpG();p.R7$(2),p.Y8G("ngIf",n.isUrl(t.post)),p.R7$(),p.Y8G("ngIf",!n.isUrl(t.post))}}function Sy(r,e){if(1&r){const t=p.RV6();p.j41(0,"div",39)(1,"div",40)(2,"img",41),p.bIt("click",function(){const i=p.eBV(t).$implicit,s=p.XpG(2);return p.Njj(s.verUsuario(i.idUser))}),p.k0s(),p.j41(3,"span"),p.EFF(4),p.k0s()(),p.j41(5,"div",42)(6,"p",43),p.EFF(7),p.k0s(),p.j41(8,"div",44)(9,"div",21)(10,"ion-icon",23),p.bIt("click",function(){const i=p.eBV(t).$implicit,s=p.XpG(2);return p.Njj(s.likeComment2(i))}),p.k0s(),p.j41(11,"span"),p.EFF(12),p.k0s()(),p.j41(13,"div",45)(14,"div")(15,"span",18),p.bIt("click",function(){const i=p.eBV(t),s=i.$implicit,a=i.index,u=p.XpG(2);return p.Njj(u.opciones2(a,s))}),p.EFF(16,"\u22ee"),p.k0s()()()()()()}if(2&r){const t=e.$implicit,n=p.XpG(2);p.R7$(2),p.Y8G("src",t.imagen||"https://forma-architecture.com/wp-content/uploads/2021/04/Foto-de-perfil-vacia-thegem-person.jpg",p.B4B),p.R7$(2),p.JRh(t.usuario),p.R7$(3),p.SpI(" ",t.comentario," "),p.R7$(3),p.AVh("liked",t.likedByComment&&t.likedByComment.includes(n.currentUser.uid)),p.R7$(2),p.JRh(t.likesCountComment)}}function xy(r,e){if(1&r){const t=p.RV6();p.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),p.EFF(3,"Comentarios"),p.k0s(),p.j41(4,"ion-buttons",28)(5,"ion-button",29),p.bIt("click",function(){p.eBV(t);const i=p.XpG();return p.Njj(i.closeModal())}),p.EFF(6,"Cerrar"),p.k0s()()()(),p.j41(7,"ion-content")(8,"div",30)(9,"span",31),p.bIt("click",function(){p.eBV(t);const i=p.XpG();return p.Njj(i.close())}),p.k0s(),p.j41(10,"div",32)(11,"div",33),p.DNE(12,Sy,17,6,"div",34),p.k0s()(),p.j41(13,"div",35)(14,"form",36,1),p.bIt("submit",function(){p.eBV(t);const i=p.XpG();return p.Njj(i.addComment2(i.comentario))}),p.j41(16,"ion-list")(17,"ion-item")(18,"ion-textarea",37),p.mxI("ngModelChange",function(i){p.eBV(t);const s=p.XpG();return p.DH7(s.comentario,i)||(s.comentario=i),p.Njj(i)}),p.k0s()()(),p.j41(19,"div",7)(20,"ion-button",38),p.EFF(21," Comentar "),p.k0s()()()()()()}if(2&r){const t=p.sdS(15),n=p.XpG();p.R7$(12),p.Y8G("ngForOf",n.dataVideoId2.commentsVideo),p.R7$(6),p.R50("ngModel",n.comentario),p.R7$(2),p.Y8G("disabled",!t.valid)}}let by=(()=>{var r;class e{constructor(n,i,s,a,u,c,h){this.afAuth=n,this._user=i,this.toastr=s,this.router=a,this._post=u,this.actionSheetCtrl=c,this.alertCtrl=h,this.esInvitado=!1,this.adm=!1,this.post=[],this.usuariosInfo=[],this.infoText="",this.option=!1,this.modalcom=!1,this.modal=!1,this.modalEditar=!1,this.ocultarx=!1,this.modalDelete=!1,this.comentario="",this.presentingElement=null,this.alertButtons=["OK"],this.alertInputs=[{type:"textarea"}]}ngOnInit(){this.afAuth.user.subscribe(n=>{this.usuario=n,this.currentUser=n,this.getUsers(),this.obtPost(),this.usuarioActual=null==n?void 0:n.displayName;const i=null==n?void 0:n.uid;"Invitad@"==this.usuarioActual&&(this.esInvitado=!0),"rm01jawdLvYSObMPDc8BTBasbJp2"==i&&(this.esInvitado=!0),"QxwJYfG0c2MwfjnJR70AdmmKOIz2"==i&&(this.adm=!0)}),this.presentingElement=document.querySelector(".ion-page")}publicar(){var n=this;return(0,b.A)(function*(){if(n.infoText&&n.infoText.trim()){var i,s,a;const u=yield n.afAuth.currentUser,c=null==u?void 0:u.uid;let h=null===(i=n.objetoUsuario)||void 0===i?void 0:i.foto;null==h&&(h="https://forma-architecture.com/wp-content/uploads/2021/04/Foto-de-perfil-vacia-thegem-person.jpg");let f=null!==(s=null===(a=n.objetoUsuario)||void 0===a?void 0:a.usuario)&&void 0!==s?s:null==u?void 0:u.displayName;if(!f)return void console.error("Nombre de usuario no disponible");n._post.addPost({foto:h,usuario:f,post:n.infoText,uid:c,timestamp:new Date}).then(()=>{n.infoText=""})}else console.log("El texto est\xe1 vac\xedo o solo contiene espacios en blanco.")})()}obtPost(){this._post.getPost().subscribe(n=>{this.post=[],n.forEach(i=>{const s=i.payload.doc.data();this.post.push({id:i.payload.doc.id,...i.payload.doc.data(),likesCountImage:s.likesCountImage||0,likedByImage:s.likedByImage||[],userImageLikes:s.userImageLikes||[],commentsVideo:s.commentsVideo||[]})})})}getUsers(){this._user.getUsers().subscribe(n=>{this.usuariosInfo=[],n.forEach(i=>{i.payload.doc.data(),this.usuariosInfo.push({id:i.payload.doc.data(),...i.payload.doc.data()});const a=this.usuariosInfo.find(u=>{var c;return u.id.idUser===(null===(c=this.usuario)||void 0===c?void 0:c.uid)});this.objetoUsuario=a})})}isUrl(n){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(n)}verUsuario(n){var i=this;return(0,b.A)(function*(){if(console.log(n),"QxwJYfG0c2MwfjnJR70AdmmKOIz2"!=n){const a=yield i.afAuth.currentUser;i.router.navigate((null==a?void 0:a.uid)===n?["/perfil"]:["/usuario/",n])}})()}deletePost(n){this._post.delete(n).then(()=>{this.option=!1,this.toastr.info("publicacion eliminada")})}opciones(n,i){var s=this;return(0,b.A)(function*(){const a=yield s.afAuth.currentUser;if((null==a?void 0:a.uid)===i.uid||"administrador.sistema@gmail.com"==(null==a?void 0:a.email)){const u=yield s.actionSheetCtrl.create({header:"Acciones",buttons:[{text:"Eliminar",role:"destructive",data:{action:"delete"}},{text:"Cancelar",role:"cancel",data:{action:"cancel"}}]});yield u.present();const c=null==i?void 0:i.id,{data:h}=yield u.onDidDismiss();h&&"delete"===h.action&&s._post.delete(c).then(()=>{s.toastr.info("publicacion eliminada")})}})()}openModal(){var n;null===(n=this.modal2)||void 0===n||n.present()}abrirCom2(n){var i=this;return(0,b.A)(function*(){var a;i.dataVideoId2=n,(yield i.afAuth.currentUser)&&!i.esInvitado?null===(a=i.modal2)||void 0===a||a.present():i.modal=!0})()}closeModal(){var n;null===(n=this.modal2)||void 0===n||n.dismiss()}returnTrue(){return!0}likeImage2(n){var i=this;return(0,b.A)(function*(){const s=yield i.afAuth.currentUser;if(s&&!i.esInvitado){const a=s.uid,u=s.displayName,c=s.email,h=n.likedByImage.indexOf(a);-1!==h?(n.likedByImage.splice(h,1),n.userImageLikes.splice(h,1),n.likesCountImage--):(n.likedByImage.push(a),n.likesCountImage++,n.userImageLikes.push({usuario:u,correo:c}));const f=n.id,g={likesCountImage:n.likesCountImage,likedByImage:n.likedByImage,userImageLikes:n.userImageLikes};yield i._post.update(f,g)}else i.modal=!0})()}close(){this.modal=!1,this.modalcom=!1}likeComment2(n){var i=this;return(0,b.A)(function*(){const s=yield i.afAuth.currentUser;if(s&&!i.esInvitado){if(!n)return void console.error("El comentario no est\xe1 definido");n.likedByComment||(n.likedByComment=[]);const a=s.uid,u=n.likedByComment.indexOf(a);-1!==u?(n.likedByComment.splice(u,1),n.likesCountComment=Math.max(0,n.likesCountComment-1)):(n.likedByComment.push(a),n.likesCountComment=(n.likesCountComment||0)+1);const c=i.dataVideoId2.id;if(-1!==i.dataVideoId2.commentsVideo.findIndex(f=>f===n)){const f={commentsVideo:i.dataVideoId2.commentsVideo};yield i._post.update(c,f)}}else i.modal=!0})()}abrirEditar(n){var i=this;return(0,b.A)(function*(){const s=yield i.afAuth.currentUser;((null==s?void 0:s.email)===n.correo||"administrador.sistema@gmail.com"==(null==s?void 0:s.email))&&(i.modalEditar=!0,i.ocultarx=!1),i.comentarioDel=n,i.esteComentario=n.comentario})()}deleteModal(n){var i=this;return(0,b.A)(function*(){const s=yield i.afAuth.currentUser;((null==s?void 0:s.email)===n.correo||"administrador.sistema@gmail.com"==(null==s?void 0:s.email))&&(i.modalDelete=!0,i.ocultarx=!1),i.comentarioDel=n})()}opciones2(n,i){var s=this;return(0,b.A)(function*(){s.comentarioDel=i,s.esteComentario=i.comentario;const a=yield s.afAuth.currentUser;if((null==a?void 0:a.uid)===i.idUser||"administrador.sistema@gmail.com"==(null==a?void 0:a.email)){const u=yield s.actionSheetCtrl.create({header:"Acciones",buttons:[{text:"Editar comentario",data:{action:"editar"}},{text:"Eliminar",role:"destructive",data:{action:"delete"}},{text:"Cancelar",role:"cancel",data:{action:"cancel"}}]});yield u.present();const{data:c}=yield u.onDidDismiss();if(c&&"delete"===c.action){const h=s.dataVideoId2.commentsVideo.indexOf(s.comentarioDel);-1!==h?(s.dataVideoId2.commentsVideo.splice(h,1),s._post.update(s.dataVideoId2.id,{commentsVideo:s.dataVideoId2.commentsVideo}).then(()=>{s.modalDelete=!1,s.ocultarx=!0,s.option=!1,console.log("Comentario eliminado correctamente")}).catch(y=>{console.error("Error al eliminar el comentario:",y)})):console.error("\xcdndice de comentario no v\xe1lido")}else"editar"==c.action&&s.presentAlert()}})()}presentAlert(){var n=this;return(0,b.A)(function*(){yield(yield n.alertCtrl.create({header:"Editar Comentario",inputs:[{name:"comentario",type:"textarea",placeholder:"Escribe tu comentario",value:n.esteComentario}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:s=>{const a=s.comentario,u=n.dataVideoId2.commentsVideo.indexOf(n.comentarioDel);-1!==u?(n.dataVideoId2.commentsVideo[u].comentario=a,n._post.update(n.dataVideoId2.id,{commentsVideo:n.dataVideoId2.commentsVideo}).then(()=>{n.modalEditar=!1,n.ocultarx=!0,console.log("Comentario editado correctamente")}).catch(f=>{console.error("Error al editar el comentario:",f)})):console.error("\xcdndice de comentario no v\xe1lido")}}]})).present()})()}addComment2(n){var i=this;return(0,b.A)(function*(){const s=yield i.afAuth.currentUser;if(s){var a;const u=i.dataVideoId2,c=null===(a=i.dataVideoId2)||void 0===a?void 0:a.id;u.commentsVideo.push({usuario:null==s?void 0:s.displayName,correo:null==s?void 0:s.email,comentario:n,imagen:null==s?void 0:s.photoURL,idUser:null==s?void 0:s.uid});const R={commentsVideo:u.commentsVideo};yield i._post.update(c,R),i.comentario=""}})()}}return(r=e).\u0275fac=function(n){return new(n||r)(p.rXU(Ye.DS),p.rXU(Ud),p.rXU(Ey.tw),p.rXU(mi.Ix),p.rXU(Ay),p.rXU(ie.GD),p.rXU(ie.hG))},r.\u0275cmp=p.VBU({type:r,selectors:[["app-explore-container"]],viewQuery:function(n,i){if(1&n&&p.GBs(wy,5),2&n){let s;p.mGM(s=p.lsd())&&(i.modal2=s.first)}},inputs:{name:"name"},decls:16,vars:6,consts:[["modal",""],["commentForm","ngForm"],["id","container"],[2,"margin-bottom","18px"],[3,"ngSubmit"],[2,"border-radius","12px"],["aria-label","Comments","placeholder","Publicar Nota...","name","infoText","cols","40","rows","3",1,"textarea",3,"ngModelChange","ngModel"],[2,"text-align","end"],["color","tertiary","type","submit",1,"btn2",3,"disabled"],[4,"ngFor","ngForOf"],["trigger","open-modal",3,"presentingElement"],["trigger","present-alert","header","Please enter your info",3,"buttons","inputs"],[4,"ngIf"],["style","margin-bottom: 5px; margin-top: 5px; width: 100%",4,"ngIf"],[2,"display","flex","justify-content","space-between"],[2,"gap","7px","display","flex","align-items","center"],["alt","foto",2,"border-radius","50%","width","40px","height","40px",3,"click","src"],[2,"text-align","justify","color","blue"],[2,"font-size","26px","cursor","pointer",3,"click"],["alt","Imagen del mensaje",2,"width","93%",3,"src"],[2,"padding-top","8px","gap","2rem","display","flex","justify-content","center"],[2,"display","flex","align-items","center"],["name","chatbubble-ellipses-outline",3,"click"],["name","heart-outline",3,"click"],[2,"margin-bottom","5px","margin-top","5px","width","100%"],[2,"padding-top","10px","padding-bottom","14px","border-bottom","1px #80808063 solid"],[2,"display","flex","align-items","center","gap","4px"],[2,"text-align","justify","color","red"],["slot","end"],[3,"click"],[1,"modal-com",2,"text-align","justify","padding","0 10px 0 10px"],[1,"fas","fa-times","lax2",3,"click"],[1,"comments-container"],[1,"comments-list",2,"display","flex","row-gap","1rem","flex-direction","column"],["style","border-bottom: 1px solid #a1a197",4,"ngFor","ngForOf"],[1,"comment-input",2,"margin-top","15px"],[3,"submit"],["aria-label","Comments","placeholder","Agregar un comentario","id","comentario","name","comentario","rows","4","cols","50","required","",3,"ngModelChange","ngModel"],["color","tertiary","type","submit",2,"padding","4px","border-radius","7px",3,"disabled"],[2,"border-bottom","1px solid #a1a197"],[2,"display","flex","flex-direction","column"],["alt","Foto de perfil","width","50","height","50",2,"cursor","pointer","border-radius","50%",3,"click","src"],[2,"display","flex","align-items","center","justify-content","space-between","border","1px solid #80808054","border-radius","9px","padding","3px"],[2,"padding","16px","width","86%"],[2,"display","flex","gap","1rem","align-items","center"],[2,"gap","1rem","display","flex","align-items","center"]],template:function(n,i){if(1&n){const s=p.RV6();p.j41(0,"div",2)(1,"div")(2,"div")(3,"div",3)(4,"form",4),p.bIt("ngSubmit",function(){return p.eBV(s),p.Njj(i.publicar())}),p.j41(5,"ion-list",5)(6,"ion-item")(7,"ion-textarea",6),p.mxI("ngModelChange",function(u){return p.eBV(s),p.DH7(i.infoText,u)||(i.infoText=u),p.Njj(u)}),p.k0s()()(),p.j41(8,"div",7)(9,"ion-button",8),p.EFF(10," Publicar "),p.k0s()()()(),p.DNE(11,Vy,4,2,"div",9),p.k0s(),p.j41(12,"ion-modal",10,0),p.DNE(14,xy,22,3,"ng-template"),p.k0s(),p.nrm(15,"ion-alert",11),p.k0s()()}2&n&&(p.R7$(7),p.R50("ngModel",i.infoText),p.R7$(2),p.Y8G("disabled",!i.infoText||!i.infoText.trim()),p.R7$(2),p.Y8G("ngForOf",i.post),p.R7$(),p.Y8G("presentingElement",i.presentingElement),p.R7$(3),p.Y8G("buttons",i.alertButtons)("inputs",i.alertInputs))},dependencies:[fi.Sq,fi.bT,zt.qT,zt.BC,zt.cb,zt.YS,zt.vS,zt.cV,ie.Zy,ie.Jm,ie.QW,ie.W9,ie.eU,ie.iq,ie.uz,ie.nf,ie.nc,ie.BC,ie.ai,ie.Sb,ie.Gw],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);overflow-y:auto;max-height:80vh;padding:10px;box-sizing:border-box}#container[_ngcontent-ng-c575013836][_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}#container[_ngcontent-ng-c575013836][_ngcontent-%COMP%]{scrollbar-width:none}#container[_ngcontent-ng-c575013836][_ngcontent-%COMP%]{-ms-overflow-style:none}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.activar[_ngcontent-%COMP%]{display:none}.activar[_ngcontent-%COMP%]:not(.active){display:none}.activar.active[_ngcontent-%COMP%]{display:flex}"]}),e})();const Cy=[{path:"",component:(()=>{var r;class e{constructor(n,i,s,a){this.afAuth=n,this.router=i,this.menu=s,this._user=a,this.esInvitado=!1,this.modal=!1,this.usuariosInfo=[]}ngOnInit(){this.afAuth.user.subscribe(n=>{this.usuario=n,this.usuarioActual=null==n?void 0:n.displayName,"Invitad@"==this.usuarioActual&&(this.esInvitado=!0)}),this.menu.close(),this.getUsers()}getUsers(){this._user.getUsers().subscribe(n=>{this.usuariosInfo=[],n.forEach(i=>{i.payload.doc.data(),this.usuariosInfo.push({id:i.payload.doc.data(),...i.payload.doc.data()});const a=this.usuariosInfo.find(u=>{var c;return u.id.idUser===(null===(c=this.usuario)||void 0===c?void 0:c.uid)});this.objetoUsuario=a})})}salir(){var n=this;return(0,b.A)(function*(){console.log("click"),yield n.menu.close(),n.afAuth.signOut().then(()=>{n.router.navigate(["/login"])})})()}}return(r=e).\u0275fac=function(n){return new(n||r)(p.rXU(Ye.DS),p.rXU(mi.Ix),p.rXU(ie._t),p.rXU(Ud))},r.\u0275cmp=p.VBU({type:r,selectors:[["app-tab1"]],decls:26,vars:2,consts:[["contentId","main-content"],[1,"ion-padding"],[3,"click"],["id","main-content",1,"ion-page"],["slot","start"],[2,"display","flex"],[2,"width","45px","height","45px"],["alt","Silhouette of a person's head",3,"src"],["collapse","condense"],["size","large"],["name","Tab 1 page"]],template:function(n,i){1&n&&(p.j41(0,"ion-app")(1,"ion-menu",0)(2,"ion-header")(3,"ion-toolbar")(4,"ion-title"),p.EFF(5,"Asomos"),p.k0s()()(),p.j41(6,"ion-content",1)(7,"ion-list")(8,"ion-item",2),p.bIt("click",function(){return i.salir()}),p.EFF(9,"Salir"),p.k0s()()()(),p.j41(10,"div",3)(11,"ion-header")(12,"ion-toolbar")(13,"ion-buttons",4),p.nrm(14,"ion-menu-button"),p.k0s(),p.j41(15,"div",5)(16,"ion-avatar",6),p.nrm(17,"img",7),p.k0s(),p.j41(18,"ion-title"),p.EFF(19),p.k0s()()()(),p.j41(20,"ion-content")(21,"ion-header",8)(22,"ion-toolbar")(23,"ion-title",9),p.EFF(24,"mis features"),p.k0s()()(),p.nrm(25,"app-explore-container",10),p.k0s()()()),2&n&&(p.R7$(17),p.Y8G("src",(null==i.objetoUsuario?null:i.objetoUsuario.foto)||"https://ionicframework.com/docs/img/demos/avatar.svg",p.B4B),p.R7$(2),p.SpI("\xa1Hola ",i.usuarioActual,"!"))},dependencies:[ie.U1,ie.mC,ie.QW,ie.W9,ie.eU,ie.uz,ie.nf,ie.oS,ie.MC,ie.BC,ie.ai,by]}),e})()}];let Dy=(()=>{var r;class e{}return(r=e).\u0275fac=function(n){return new(n||r)},r.\u0275mod=p.$C({type:r}),r.\u0275inj=p.G2t({imports:[mi.iI.forChild(Cy),mi.iI]}),e})(),ky=(()=>{var r;class e{}return(r=e).\u0275fac=function(n){return new(n||r)},r.\u0275mod=p.$C({type:r}),r.\u0275inj=p.G2t({imports:[ie.bv,fi.MD,zt.YN,jf.S,Dy]}),e})()}}]);